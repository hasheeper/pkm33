const GLORIA_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Zacian-Crowned",lv:99,gender:"N",nature:"Adamant",ability:"Intrepid Sword",item:"Rusted Sword",isAce:true,stats_meta:{is_perfect:true,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Behemoth Blade","Play Rough","Close Combat","Swords Dance"],friendship:{trust:255,passion:255,insight:200,devotion:150}},{name:"Cinderace",lv:97,gender:"M",nature:"Jolly",ability:"Libero",item:"Life Orb",mechanic:"dynamax",mega_target:"cinderacegmax",stats_meta:{ev_level:252},moves:["Pyro Ball","Bounce","High Jump Kick","Court Change"],avs:{trust:150,passion:230}},{name:"Rillaboom",lv:95,gender:"M",nature:"Adamant",ability:"Grassy Surge",item:"Grassy Seed",mechanic:"dynamax",mega_target:"rillaboomgmax",stats_meta:{ev_level:252},moves:["Grassy Glide","Drum Beating","High Horsepower","U-turn"]},{name:"Urshifu-Rapid-Strike",lv:94,gender:"M",nature:"Jolly",ability:"Unseen Fist",item:"Focus Sash",mechanic:"dynamax",mega_target:"urshifurapidstrikegmax",stats_meta:{ev_level:252},moves:["Surging Strikes","Close Combat","Ice Punch","Aqua Jet"]},{name:"Corviknight",lv:94,gender:"M",nature:"Impish",ability:"Mirror Armor",item:"Leftovers",mechanic:"dynamax",mega_target:"corviknightgmax",stats_meta:{ev_level:252},moves:["Brave Bird","Body Press","Iron Defense","Roost"],avs:{trust:220,devotion:200}},{name:"Skwovet",lv:99,gender:"F",nature:"Relaxed",ability:"Cheek Pouch",item:"Sitrus Berry",mechanic:"dynamax",stats_meta:{ev_level:252},moves:["Super Fang","Stuff Cheeks","Body Slam","Stockpile"],avs:{trust:255,insight:255,devotion:255,passion:255}}]}};const AKARI_DATA={4:{unlocks:{enable_bond:false,enable_styles:true,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Samurott-Hisui",lv:99,gender:"F",nature:"Adamant",ability:"Sharpness",item:"Choice Scarf",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Ceaseless Edge","Razor Shell","X-Scissor","Sacred Sword"],isAce:true,friendship:{trust:150,passion:200,insight:220,devotion:100}},{name:"Kleavor",lv:97,gender:"M",nature:"Jolly",ability:"Sharpness",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Stone Axe","X-Scissor","Close Combat","Quick Attack"]},{name:"Zoroark-Hisui",lv:95,gender:"M",nature:"Timid",ability:"Illusion",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Shadow Ball","Hyper Voice","Flamethrower","Nasty Plot"]},{name:"Ursaluna",lv:96,gender:"M",nature:"Adamant",ability:"Guts",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Facade","Headlong Rush","Fire Punch","Swords Dance"]},{name:"Pikachu",lv:100,gender:"M",nature:"Naive",ability:"Static",item:"Light Ball",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Volt Tackle","Iron Tail","Play Rough","Swift"]},{name:"Staraptor",lv:94,gender:"F",nature:"Jolly",ability:"Reckless",item:"Choice Band",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Brave Bird","Double-Edge","Close Combat","U-turn"]}]}};const ROSA_DATA={4:{unlocks:{enable_bond:true,enable_styles:false,enable_insight:true,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Serperior",lv:99,gender:"F",nature:"Timid",ability:"Contrary",item:"Leftovers",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Leaf Storm","Dragon Pulse","Glare","Substitute"],isAce:true,friendship:{trust:150,passion:150,insight:150,devotion:255}},{name:"Emboar",lv:96,gender:"M",nature:"Brave",ability:"Reckless",item:"Choice Band",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Flare Blitz","Superpower","Wild Charge","Head Smash"],isAce:true,friendship:{trust:100,passion:255,insight:100,devotion:120}},{name:"Samurott",lv:96,gender:"M",nature:"Adamant",ability:"Shell Armor",item:"Life Orb",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Liquidation","Aqua Jet","Knock Off","Megahorn"],isAce:true,friendship:{trust:200,passion:150,insight:150,devotion:100}},{name:"Simisear",lv:93,gender:"M",nature:"Timid",ability:"Blaze",item:"Focus Sash",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Fire Blast","Grass Knot","Nasty Plot","Focus Blast"],isAce:false,friendship:{trust:100,passion:200}},{name:"Simipour",lv:93,gender:"M",nature:"Timid",ability:"Torrent",item:"Expert Belt",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Hydro Pump","Ice Beam","Scald","Taunt"],isAce:false,friendship:{trust:100,passion:100,insight:150}},{name:"Delibird",lv:92,gender:"F",nature:"Jolly",ability:"Hustle",item:"Focus Sash",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Ice Shard","Destiny Bond","Brave Bird","Drill Run"],isAce:false,friendship:{trust:80,passion:200,insight:255,devotion:50}}]}};const SERENA_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Absol",lv:99,gender:"F",nature:"Jolly",ability:"Justified",item:"Absolite",mechanic:"mega",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Sucker Punch","Play Rough","Knock Off","Swords Dance"]},{name:"Delphox",lv:99,gender:"F",nature:"Timid",ability:"Blaze",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},isAce:true,friendship:{trust:150,passion:255,insight:120,devotion:100},moves:["Fire Blast","Psychic","Dazzling Gleam","Calm Mind"]},{name:"Greninja",lv:93,gender:"M",nature:"Naive",ability:"Protean",item:"Choice Scarf",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Ice Beam","Dark Pulse","Gunk Shot","U-turn"]},{name:"Zygarde",lv:95,gender:"N",nature:"Adamant",ability:"Power Construct",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Thousand Arrows","Dragon Dance","Substitute","Extreme Speed"]},{name:"Sylveon",lv:88,gender:"F",nature:"Modest",ability:"Pixilate",item:"Choice Specs",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Hyper Voice","Psyshock","Shadow Ball","Quick Attack"]},{name:"Vaporeon",lv:85,gender:"F",nature:"Bold",ability:"Water Absorb",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Scald","Wish","Protect","Toxic"]}]}};const DAWN_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:true,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Lopunny",lv:98,gender:"F",nature:"Jolly",ability:"Scrappy",item:"Lopunnite",mechanic:"mega",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Fake Out","Return","High Jump Kick","Ice Punch"],isAce:true,friendship:{trust:150,passion:200,insight:255,devotion:120}},{name:"Togekiss",lv:94,gender:"F",nature:"Timid",ability:"Serene Grace",item:"Kings Rock",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Air Slash","Dazzling Gleam","Aura Sphere","Nasty Plot"]},{name:"Infernape",lv:95,gender:"M",nature:"Naive",ability:"Iron Fist",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Fire Blast","Close Combat","Mach Punch","Grass Knot"],isAce:true},{name:"Empoleon",lv:95,gender:"M",nature:"Modest",ability:"Competitive",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Hydro Pump","Flash Cannon","Ice Beam","Jet Punch"],moves:["Hydro Pump","Flash Cannon","Ice Beam","Aqua Jet"]},{name:"Torterra",lv:94,gender:"M",nature:"Adamant",ability:"Shell Armor",item:"Yache Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Wood Hammer","Earthquake","Stone Edge","Synthesis"]},{name:"Pachirisu",lv:98,gender:"F",nature:"Impish",ability:"Volt Absorb",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Nuzzle","Super Fang","Charm","Protect"],isAce:true,friendship:{trust:255,passion:80,insight:200,devotion:200}}]}};const SELENE_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:true,enable_dynamax:false,enable_tera:false},party:[{name:"Decidueye",lv:98,gender:"M",nature:"Adamant",ability:"Long Reach",item:"Decidium Z",mechanic:"zmove",isAce:true,friendship:{trust:255,passion:180,insight:180,devotion:120},stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Spirit Shackle","Leaf Blade","Brave Bird","Sucker Punch"]},{name:"Incineroar",lv:94,gender:"M",nature:"Adamant",ability:"Intimidate",item:"Sitrus Berry",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Darkest Lariat","Flare Blitz","Fake Out","Parting Shot"]},{name:"Snorlax",lv:95,gender:"M",nature:"Impish",ability:"Thick Fat",item:"Leftovers",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Giga Impact","Body Slam","Rest","Sleep Talk"]},{name:"Lycanroc-Dusk",lv:96,gender:"M",nature:"Jolly",ability:"Tough Claws",item:"Life Orb",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Stone Edge","Accelerock","Close Combat","Psychic Fangs"]},{name:"Scizor",lv:95,gender:"M",nature:"Adamant",ability:"Technician",item:"Choice Band",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Bullet Punch","U-turn","Dual Wingbeat","Superpower"]},{name:"Umbreon",lv:92,gender:"M",nature:"Calm",ability:"Synchronize",item:"Rocky Helmet",stats_meta:{ev_level:252,ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31}},moves:["Foul Play","Moonlight","Toxic","Protect"]}]}};const JULIANA_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:true},party:[{name:"Miraidon",lv:99,gender:"N",nature:"Modest",ability:"Hadron Engine",item:"Choice Specs",mechanic:"tera",teraType:"Electric",isAce:true,friendship:{trust:255,passion:255,insight:100,devotion:120},stats_meta:{ev_level:252,ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31}},moves:["Electro Drift","Dragon Pulse","Parabolic Charge","Volt Switch"]},{name:"Meowscarada",lv:98,gender:"F",nature:"Jolly",ability:"Protean",item:"Focus Sash",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Flower Trick","Knock Off","U-turn","Play Rough"]},{name:"Kingambit",lv:97,gender:"M",nature:"Adamant",ability:"Supreme Overlord",item:"Black Glasses",mechanic:"tera",teraType:"Dark",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Kowtow Cleave","Sucker Punch","Iron Head","Swords Dance"]},{name:"Tinkaton",lv:96,gender:"F",nature:"Jolly",ability:"Mold Breaker",item:"Leftovers",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Gigaton Hammer","Play Rough","Knock Off","Thunder Wave"]},{name:"Ceruledge",lv:95,gender:"M",nature:"Jolly",ability:"Weak Armor",item:"Life Orb",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Bitter Blade","Shadow Sneak","Close Combat","Swords Dance"]},{name:"Pawmot",lv:94,gender:"F",nature:"Jolly",ability:"Iron Fist",item:"Leppa Berry",stats_meta:{ev_level:252,ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}},moves:["Revival Blessing","Double Shock","Close Combat","Mach Punch"]}]}};const LUSAMINE_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:true,enable_dynamax:false,enable_tera:false},party:[{name:"Nihilego",lv:99,gender:"N",nature:"Timid",ability:"Beast Boost",item:"Rockium Z",mechanic:"zmove",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Power Gem","Sludge Wave","Stealth Rock","Thunderbolt"],isAce:true,friendship:{trust:80,passion:120,insight:140,devotion:255}},{name:"Pheromosa",lv:98,gender:"N",nature:"Naughty",ability:"Beast Boost",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["High Jump Kick","U-turn","Ice Beam","Poison Jab"]},{name:"Bewear",lv:92,gender:"F",nature:"Adamant",ability:"Fluffy",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Double-Edge","Superpower","Darkest Lariat","Ice Punch"]},{name:"Milotic",lv:82,gender:"F",nature:"Bold",ability:"Marvel Scale",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Scald","Recover","Haze","Ice Beam"]},{name:"Lilligant",lv:75,gender:"F",nature:"Modest",ability:"Own Tempo",item:"Kee Berry",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Quiver Dance","Petal Dance","Sleep Powder","Giga Drain"]},{name:"Clefable",lv:85,gender:"F",nature:"Calm",ability:"Magic Guard",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Moonblast","Soft-Boiled","Cosmic Power","Stored Power"]}]}};const LILLIE_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:true,enable_dynamax:false,enable_tera:false},party:[{name:"Clefairy",lv:85,gender:"F",nature:"Bold",ability:"Magic Guard",item:"Eviolite",mechanic:"zmove",isAce:true,stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Moonblast","Moonlight","Cosmic Power","Minimize"],friendship:{trust:220,passion:60,insight:120,devotion:255}},{name:"Ninetales-Alola",lv:84,gender:"F",nature:"Timid",ability:"Snow Warning",item:"Icium Z",mechanic:"zmove",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Blizzard","Aurora Veil","Freeze-Dry","Moonblast"]},{name:"Magearna",lv:82,gender:"N",nature:"Modest",ability:"Soul-Heart",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Fleur Cannon","Flash Cannon","Aura Sphere","Volt Switch"]},{name:"Ribombee",lv:82,gender:"F",nature:"Timid",ability:"Shield Dust",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Sticky Web","Moonblast","U-turn","Pollen Puff"]},{name:"Lilligant",lv:80,gender:"F",nature:"Modest",ability:"Own Tempo",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Quiver Dance","Petal Dance","Giga Drain","Hidden Power Fire"]},{name:"Comfey",lv:80,gender:"F",nature:"Bold",ability:"Triage",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Draining Kiss","Giga Drain","Synthesis","Calm Mind"]}]}};const MALLOW_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:true,enable_dynamax:false,enable_tera:false},party:[{name:"Tsareena",lv:85,gender:"F",nature:"Adamant",ability:"Queenly Majesty",item:"Grassium Z",mechanic:"zmove",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Power Whip","High Jump Kick","Trop Kick","U-turn"],isAce:true,friendship:{trust:140,passion:200,insight:100,devotion:180}},{name:"Lurantis",lv:84,gender:"F",nature:"Brave",ability:"Contrary",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Leaf Storm","Superpower","Synthesis","Poison Jab"]},{name:"Trevenant",lv:83,gender:"M",nature:"Impish",ability:"Harvest",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Will-O-Wisp","Poltergeist","Horn Leech","Leech Seed"]},{name:"Appletun",lv:82,gender:"M",nature:"Bold",ability:"Thick Fat",item:"Rocky Helmet",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Apple Acid","Dragon Pulse","Recover","Body Press"]},{name:"Alcremie",lv:80,gender:"F",nature:"Calm",ability:"Sweet Veil",item:"Wiki Berry",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Dazzling Gleam","Mystical Fire","Calm Mind","Recover"]},{name:"Exeggutor-Alola",lv:82,gender:"M",nature:"Quiet",ability:"Frisk",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Draco Meteor","Flamethrower","Giga Drain","Sludge Bomb"]}]}};const LANA_DATA={4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:true,enable_dynamax:false,enable_tera:false},party:[{name:"Araquanid",lv:85,gender:"F",nature:"Adamant",ability:"Water Bubble",item:"Waterium Z",mechanic:"zmove",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Liquidation","Leech Life","Lunge","Sticky Web"],isAce:true,friendship:{trust:160,passion:200,insight:120,devotion:120}},{name:"Cloyster",lv:84,gender:"M",nature:"Jolly",ability:"Skill Link",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Shell Smash","Icicle Spear","Rock Blast","Ice Shard"]},{name:"Wishiwashi",lv:83,gender:"M",nature:"Quiet",ability:"Schooling",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:0},ev_level:252},moves:["Hydro Pump","Earthquake","Ice Beam","U-turn"]},{name:"Golisopod",lv:83,gender:"M",nature:"Adamant",ability:"Emergency Exit",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["First Impression","Aqua Jet","Liquidation","Sucker Punch"]},{name:"Lanturn",lv:82,gender:"F",nature:"Calm",ability:"Volt Absorb",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Scald","Volt Switch","Thunder Wave","Heal Bell"]},{name:"Primarina",lv:82,gender:"F",nature:"Modest",ability:"Torrent",item:"Choice Specs",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Moonblast","Hydro Pump","Psychic","Energy Ball"]}]}};const IRIDA_DATA={4:{unlocks:{enable_bond:false,enable_styles:true,enable_insight:true,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Glaceon",lv:86,gender:"F",nature:"Modest",ability:"Snow Cloak",item:"Bright Powder",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Blizzard","Freeze-Dry","Calm Mind","Shadow Ball"],isAce:true,friendship:{trust:160,passion:100,insight:255,devotion:120}},{name:"Espeon",lv:84,gender:"F",nature:"Timid",ability:"Magic Bounce",item:"Light Clay",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Psychic","Dazzling Gleam","Reflect","Light Screen"]},{name:"Avalugg-Hisui",lv:85,gender:"M",nature:"Adamant",ability:"Strong Jaw",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Mountain Gale","Stone Edge","Earthquake","Body Press"]},{name:"Flareon",lv:84,gender:"F",nature:"Adamant",ability:"Guts",item:"Toxic Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Flare Blitz","Facade","Superpower","Quick Attack"]},{name:"Sneasler",lv:83,gender:"F",nature:"Jolly",ability:"Unburden",item:"White Herb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Dire Claw","Close Combat","Acrobatics","Swords Dance"]},{name:"Froslass",lv:82,gender:"F",nature:"Timid",ability:"Cursed Body",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Aurora Veil","Destiny Bond","Icy Wind","Spikes"]}]}};const SONIA_DATA={4:{unlocks:{enable_bond:true,enable_styles:true,enable_insight:true,enable_mega:true,enable_z_move:true,enable_dynamax:true,enable_tera:true},party:[{name:"Yamper",lv:75,gender:"M",nature:"Impish",ability:"Ball Fetch",item:"Eviolite",mechanic:"tera",teraType:"Electric",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:{hp:252,atk:0,def:252,spa:0,spd:4,spe:0}},moves:["Nuzzle","Super Fang","Play Rough","Rest"],isAce:true,friendship:{trust:150,passion:100,insight:255,devotion:200}},{name:"Tsareena",lv:72,gender:"F",nature:"Adamant",ability:"Queenly Majesty",mechanic:"zmove",item:"Grassium Z",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:{hp:0,atk:252,def:4,spa:0,spd:0,spe:252}},moves:["Power Whip","High Jump Kick","Trop Kick","U-turn"]},{name:"Lapras",lv:70,gender:"F",nature:"Modest",ability:"Shell Armor",mechanic:"dynamax",item:"Weakness Policy",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:{hp:252,atk:0,def:0,spa:252,spd:0,spe:4}},moves:["Freeze-Dry","Hydro Pump","Thunder","Protect"]}]}};const ROXIE_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Venipede",lv:24,gender:"F",nature:"Hasty",ability:"Poison Point",item:"Poison Barb",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:5},moves:["Bug Bite","Poison Tail","Iron Defense","Screech"]},{name:"Koffing",lv:24,gender:"M",nature:"Bold",ability:"Levitate",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:5},moves:["Smog","Assurance","Clear Smog","Will-O-Wisp"]},{name:"Trubbish",lv:25,gender:"F",nature:"Adamant",ability:"Stench",item:"Oran Berry",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:20},moves:["Sludge","Toxic Spikes","Acid Spray","Double Slap"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Whirlipede",lv:48,gender:"F",nature:"Jolly",ability:"Speed Boost",item:"Eviolite",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:120},moves:["Protect","Poison Jab","Iron Defense","Bug Bite"]},{name:"Golbat",lv:48,gender:"M",nature:"Jolly",ability:"Inner Focus",item:"Sitrus Berry",stats_meta:{ivs:{hp:25,atk:31,def:25,spa:25,spd:25,spe:31},ev_level:85},moves:["Cross Poison","Confuse Ray","Bite","U-turn"]},{name:"Toxtricity",lv:49,gender:"M",nature:"Modest",ability:"Punk Rock",item:"Magnet",stats_meta:{ivs:{hp:31,atk:0,def:25,spa:31,spd:25,spe:31},ev_level:120},moves:["Overdrive","Venoshock","Snarl","Noble Roar"]},{name:"Garbodor",lv:50,gender:"F",nature:"Adamant",ability:"Weak Armor",item:"Black Sludge",isAce:true,friendship:{trust:100,passion:150,insight:80,devotion:100},stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Body Slam","Drain Punch","Toxic"]}]},3:{unlocks:{enable_bond:true,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Scolipede",lv:75,gender:"F",nature:"Jolly",ability:"Speed Boost",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Swords Dance","Iron Defense","Baton Pass","Megahorn"]},{name:"Crobat",lv:74,gender:"M",nature:"Jolly",ability:"Infiltrator",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Brave Bird","Cross Poison","U-turn","Defog"]},{name:"Toxtricity",lv:74,gender:"M",nature:"Timid",ability:"Punk Rock",item:"Throat Spray",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Boomburst","Overdrive","Sludge Wave","Shift Gear"]},{name:"Drapion",lv:73,gender:"M",nature:"Careful",ability:"Sniper",item:"Scope Lens",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Night Slash","Cross Poison","Fell Stinger","Earthquake"]},{name:"Garbodor",lv:77,gender:"F",nature:"Adamant",ability:"Weak Armor",item:"Rocky Helmet",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Seed Bomb","Drain Punch","Stomping Tantrum"],isAce:true,friendship:{trust:150,passion:255,insight:120,devotion:120}}]},4:{unlocks:{enable_bond:true,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Scolipede",lv:92,gender:"F",nature:"Jolly",ability:"Speed Boost",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Protect","Swords Dance","Baton Pass","Megahorn"]},{name:"Toxtricity",lv:90,gender:"M",nature:"Timid",ability:"Punk Rock",item:"Throat Spray",mechanic:"dynamax",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Overdrive","Sludge Wave","Boomburst","Shift Gear"]},{name:"Amoonguss",lv:89,gender:"F",nature:"Sassy",ability:"Regenerator",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:0},ev_level:252},moves:["Spore","Giga Drain","Clear Smog","Foul Play"]},{name:"Seviper",lv:88,gender:"M",nature:"Rash",ability:"Infiltrator",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Poison Jab","Flamethrower","Earthquake","Sucker Punch"]},{name:"Crobat",lv:88,gender:"M",nature:"Jolly",ability:"Infiltrator",item:"Choice Band",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Brave Bird","Cross Poison","U-turn","Zen Headbutt"]},{name:"Garbodor",lv:95,gender:"F",nature:"Adamant",ability:"Weak Armor",item:"Rocky Helmet",mechanic:"dynamax",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Seed Bomb","Stomping Tantrum","Explosion"],isAce:true,friendship:{trust:100,passion:255,insight:140,devotion:120}}]}};const IONO_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Wattrel",lv:24,gender:"F",nature:"Bashful",ability:"Wind Power",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:0},moves:["Spark","Peck","Quick Attack","Roost"]},{name:"Tadbulb",lv:25,gender:"M",nature:"Modest",ability:"Static",item:"Oran Berry",stats_meta:{ivs:{hp:25,atk:15,def:25,spa:25,spd:25,spe:15},ev_level:20},moves:["Thunder Shock","Water Gun","Round","Charge"]},{name:"Luxio",lv:25,gender:"M",nature:"Adamant",ability:"Intimidate",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:30},moves:["Spark","Bite","Thunder Wave","Roar"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Kilowattrel",lv:48,gender:"F",nature:"Timid",ability:"Volt Absorb",stats_meta:{ivs:{hp:31,atk:0,def:20,spa:31,spd:20,spe:31},ev_level:85},moves:["U-turn","Air Slash","Electro Ball","Roost"]},{name:"Luxray",lv:49,gender:"M",nature:"Jolly",ability:"Intimidate",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:25,spa:10,spd:25,spe:31},ev_level:85},moves:["Wild Charge","Crunch","Ice Fang","Thunder Wave"]},{name:"Mismagius",lv:49,gender:"F",nature:"Timid",ability:"Levitate",stats_meta:{ivs:{hp:25,atk:0,def:25,spa:31,spd:25,spe:31},ev_level:85},moves:["Magical Leaf","Shadow Ball","Mystical Fire","Hex"]},{name:"Bellibolt",lv:52,gender:"F",nature:"Modest",ability:"Electromorphosis",item:"Magnet",isAce:true,stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:120},moves:["Discharge","Sucker Punch","Wait... Sucker Punch is physical","Muddy Water","Slack Off"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:true},party:[{name:"Electrode-Hisui",lv:75,gender:"N",nature:"Timid",ability:"Static",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Volt Switch","Energy Ball","Taunt","Thunder Wave"]},{name:"Kilowattrel",lv:74,gender:"F",nature:"Timid",ability:"Wind Power",item:"Sharp Beak",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Tailwind","Thunderbolt","Hurricane","Roost"]},{name:"Luxray",lv:74,gender:"M",nature:"Adamant",ability:"Guts",item:"Expert Belt",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Wild Charge","Psychic Fangs","Crunch","Play Rough"]},{name:"Bellibolt",lv:76,gender:"F",nature:"Modest",ability:"Electromorphosis",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Parabolic Charge","Acid Spray","Muddy Water","Slack Off"]},{name:"Mismagius",lv:78,gender:"F",nature:"Timid",ability:"Levitate",item:"Sitrus Berry",mechanic:"tera",teraType:"Electric",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},isAce:true,friendship:{trust:120,passion:200,insight:100,devotion:100},moves:["Shadow Ball","Dazzling Gleam","Charge Beam","Pain Split"]}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:true},party:[{name:"Kilowattrel",lv:92,gender:"F",nature:"Timid",ability:"Wind Power",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Tailwind","Thunder","Hurricane","Volt Switch"]},{name:"Bellibolt",lv:94,gender:"F",nature:"Modest",ability:"Electromorphosis",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},isAce:true,friendship:{trust:140,passion:255,insight:100,devotion:120},moves:["Parabolic Charge","Muddy Water","Acid Spray","Slack Off"]},{name:"Mismagius",lv:95,gender:"F",nature:"Timid",ability:"Levitate",mechanic:"tera",teraType:"Electric",item:"Wise Glasses",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Tera Blast","Shadow Ball","Dazzling Gleam","Mystical Fire"]},{name:"Luxray",lv:90,gender:"M",nature:"Jolly",ability:"Guts",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Facade","Wild Charge","Superpower","Play Rough"]},{name:"Electivire",lv:91,gender:"M",nature:"Naive",ability:"Motor Drive",item:"Expert Belt",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Plasma Fists","Ice Punch","Earthquake","Flamethrower"]},{name:"Iron Hands",lv:90,gender:"N",nature:"Adamant",ability:"Quark Drive",item:"Booster Energy",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Drain Punch","Thunder Punch","Heavy Slam","Fake Out"]}]}};const ERIKA_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Oddish",lv:24,gender:"F",nature:"Calm",ability:"Chlorophyll",stats_meta:{ivs:{hp:15,atk:15,def:15,spa:15,spd:15,spe:15},ev_level:0},moves:["Absorb","Acid","Sleep Powder","Mega Drain"]},{name:"Bellsprout",lv:24,gender:"F",nature:"Modest",ability:"Chlorophyll",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:0},moves:["Vine Whip","Growth","Wrap","Poison Powder"]},{name:"Tangela",lv:25,gender:"F",nature:"Bold",ability:"Regenerator",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:10},moves:["Mega Drain","Bind","Stun Spore","Leech Seed"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Jumpluff",lv:48,gender:"F",nature:"Jolly",ability:"Chlorophyll",stats_meta:{ivs:{hp:31,atk:20,def:20,spa:10,spd:20,spe:31},ev_level:85},moves:["Sleep Powder","U-turn","Acrobatics","Leech Seed"]},{name:"Vileplume",lv:49,gender:"F",nature:"Modest",ability:"Chlorophyll",item:"Heat Rock",stats_meta:{ivs:{hp:31,atk:0,def:25,spa:31,spd:25,spe:31},ev_level:85},moves:["Solar Beam","Sludge Bomb","Moonlight","Sunny Day"]},{name:"Tangrowth",lv:49,gender:"F",nature:"Relaxed",ability:"Regenerator",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:20},ev_level:85},moves:["Giga Drain","Knock Off","Earthquake","Ancient Power"]},{name:"Venusaur",lv:50,gender:"F",nature:"Modest",ability:"Chlorophyll",item:"Miracle Seed",isAce:true,stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:120},moves:["Giga Drain","Sludge Bomb","Earth Power","Growth"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Victreebel",lv:73,gender:"F",nature:"Naughty",ability:"Chlorophyll",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Leaf Blade","Sludge Bomb","Sucker Punch","Weather Ball"]},{name:"Bellossom",lv:74,gender:"F",nature:"Modest",ability:"Chlorophyll",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Quiver Dance","Giga Drain","Moonblast","Strength Sap"]},{name:"Tangrowth",lv:74,gender:"F",nature:"Sassy",ability:"Regenerator",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:180},moves:["Power Whip","Knock Off","Earthquake","Sludge Bomb"]},{name:"Venusaur",lv:76,gender:"F",nature:"Modest",ability:"Chlorophyll",item:"Venusaurite",mechanic:"mega",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Giga Drain","Sludge Bomb","Target","Synthesis"]},{name:"Vileplume",lv:72,gender:"F",nature:"Bold",ability:"Effect Spore",item:"Black Sludge",isAce:true,stats_meta:{ivs:{hp:31,atk:0,def:31,spa:10,spd:31,spe:31},ev_level:180},moves:["Giga Drain","Sludge Bomb","Strength Sap","Sleep Powder"]}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:true,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Jumpluff",lv:88,gender:"F",nature:"Jolly",ability:"Infiltrator",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Sleep Powder","Strength Sap","U-turn","Sunny Day"]},{name:"Venusaur",lv:90,gender:"F",nature:"Bold",ability:"Chlorophyll",item:"Venusaurite",mechanic:"mega",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Giga Drain","Sludge Bomb","Synthesis","Leech Seed"],isAce:true,friendship:{trust:160,passion:100,insight:255,devotion:120}},{name:"Tangrowth",lv:89,gender:"F",nature:"Relaxed",ability:"Regenerator",item:"Rocky Helmet",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:0},ev_level:252},moves:["Giga Drain","Knock Off","Earthquake","Sleep Powder"]},{name:"Victreebel",lv:88,gender:"F",nature:"Naughty",ability:"Chlorophyll",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Leaf Blade","Sludge Bomb","Weather Ball","Sucker Punch"]},{name:"Bellossom",lv:88,gender:"F",nature:"Modest",ability:"Chlorophyll",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Quiver Dance","Moonblast","Energy Ball","Safeguard"]},{name:"Vileplume",lv:88,gender:"F",nature:"Calm",ability:"Effect Spore",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Strength Sap","Moonblast","Sludge Bomb","Aromatherapy"]}]}};const NESSA_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Goldeen",lv:24,gender:"F",nature:"Naughty",ability:"Water Veil",stats_meta:{ivs:{hp:15,atk:15,def:15,spa:15,spd:15,spe:15},ev_level:5},moves:["Water Pulse","Horn Attack","Supersonic","Rain Dance"]},{name:"Arrokuda",lv:25,gender:"M",nature:"Hasty",ability:"Swift Swim",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:5},moves:["Aqua Jet","Bite","Fury Attack","Laser Focus"]},{name:"Chewtle",lv:26,gender:"M",nature:"Adamant",ability:"Strong Jaw",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:30},moves:["Water Gun","Bite","Headbutt","Protect"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Pelipper",lv:48,gender:"M",nature:"Modest",ability:"Drizzle",stats_meta:{ivs:{hp:31,atk:0,def:25,spa:31,spd:25,spe:31},ev_level:85},moves:["Scald","Hurricane","Water Pulse","Roost"]},{name:"Barraskewda",lv:49,gender:"F",nature:"Adamant",ability:"Swift Swim",stats_meta:{ivs:{hp:31,atk:31,def:20,spa:10,spd:20,spe:31},ev_level:120},moves:["Liquidation","Aqua Jet","Bite","Flip Turn"]},{name:"Araquanid",lv:49,gender:"F",nature:"Adamant",ability:"Water Bubble",stats_meta:{ivs:{hp:31,atk:31,def:25,spa:10,spd:25,spe:20},ev_level:85},moves:["Liquidation","Bug Bite","Crunch","Mirror Coat"]},{name:"Drednaw",lv:52,gender:"M",nature:"Adamant",ability:"Strong Jaw",mechanic:"dynamax",item:"Hard Stone",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:180},moves:["Razor Shell","Rock Tomb","Jaw Lock","Crunch"]}]},3:{unlocks:{false:false,enable_dynamax:true},party:[{name:"Pelipper",lv:75,gender:"F",nature:"Modest",ability:"Drizzle",item:"Damp Rock",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Hurricane","Hydro Pump","U-turn","Roost"]},{name:"Ludicolo",lv:74,gender:"M",nature:"Modest",ability:"Swift Swim",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Hydro Pump","Giga Drain","Ice Beam","Rain Dance"]},{name:"Golisopod",lv:76,gender:"M",nature:"Adamant",ability:"Emergency Exit",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:180},moves:["First Impression","Liquidation","Aqua Jet","Sucker Punch"]},{name:"Drednaw",lv:78,gender:"M",nature:"Adamant",mechanic:"dynamax",ability:"Swift Swim",item:"White Herb",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Liquidation","Stone Edge","Superpower","Swords Dance"]},{name:"Toxapex",lv:73,gender:"F",nature:"Bold",ability:"Regenerator",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Scald","Recover","Haze","Toxic"]}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Pelipper",lv:88,gender:"F",nature:"Bold",ability:"Drizzle",item:"Damp Rock",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Scald","Hurricane","U-turn","Roost"]},{name:"Barraskewda",lv:89,gender:"M",nature:"Adamant",ability:"Swift Swim",item:"Choice Band",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Liquidation","Close Combat","Psychic Fangs","Flip Turn"]},{name:"Golisopod",lv:88,gender:"M",nature:"Adamant",ability:"Emergency Exit",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["First Impression","Aqua Jet","Leech Life","Close Combat"]},{name:"Drednaw",lv:90,gender:"M",nature:"Adamant",ability:"Swift Swim",mechanic:"dynamax",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Liquidation","Stone Edge","Superpower","Ice Fang"],isAce:true,friendship:{trust:140,passion:180,insight:100,devotion:120}},{name:"Seaking",lv:85,gender:"F",nature:"Careful",ability:"Lightning Rod",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Waterfall","Knock Off","Drill Run","Horn Drill"]},{name:"Toxapex",lv:86,gender:"F",nature:"Bold",ability:"Regenerator",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:0},ev_level:252},moves:["Scald","Recover","Haze","Toxic Spikes"]}]}};const MARNIE_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Croagunk",lv:24,gender:"M",nature:"Adamant",ability:"Dry Skin",stats_meta:{ivs:{hp:20,atk:20,def:20,spa:20,spd:20,spe:20},ev_level:20},moves:["Poison Sting","Revenge","Sucker Punch","Venoshock"]},{name:"Scraggy",lv:24,gender:"M",nature:"Impish",ability:"Shed Skin",item:"Eviolite",stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:40},moves:["Headbutt","Brick Break","Payback","Work Up"]},{name:"Morpeko",lv:26,gender:"F",nature:"Jolly",ability:"Hunger Switch",item:"Oran Berry",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:25,spd:25,spe:25},ev_level:50},moves:["Aura Wheel","Bite","Quick Attack","Protect"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Liepard",lv:48,gender:"F",nature:"Jolly",ability:"Prankster",stats_meta:{ivs:{hp:31,atk:25,def:25,spa:10,spd:25,spe:31},ev_level:120},moves:["Fake Out","Torment","Sucker Punch","U-turn"]},{name:"Toxicroak",lv:49,gender:"M",nature:"Jolly",stats_meta:{ivs:{hp:25,atk:31,def:25,spa:25,spd:25,spe:31},ev_level:85},moves:["Poison Jab","Drain Punch","Sucker Punch","Venoshock"]},{name:"Scrafty",lv:49,gender:"M",nature:"Careful",ability:"Intimidate",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:20,spd:31,spe:20},ev_level:120},moves:["Brick Break","Crunch","Ice Punch","Headbutt"]},{name:"Morpeko",lv:51,gender:"F",nature:"Jolly",item:"Silk Scarf",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Aura Wheel","Crunch","Seed Bomb","Quick Attack"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Liepard",lv:73,gender:"F",nature:"Jolly",ability:"Prankster",item:"Light Clay",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Fake Out","Taunt","Sucker Punch","Play Rough"]},{name:"Toxicroak",lv:74,gender:"M",nature:"Jolly",ability:"Dry Skin",item:"Black Sludge",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Sludge Bomb","Drain Punch","Nasty Plot","Vacuum Wave"]},{name:"Scrafty",lv:74,gender:"M",nature:"Adamant",ability:"Moxie",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:20,spd:31,spe:31},ev_level:180},moves:["Close Combat","Crunch","Ice Punch","Poison Jab"]},{name:"Morpeko",lv:75,gender:"F",nature:"Jolly",item:"Choice Band",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Aura Wheel","Psychic Fangs","Seed Bomb","Parting Shot"]},{name:"Grimmsnarl",lv:76,gender:"M",nature:"Impish",ability:"Prankster",item:"Leftovers",mechanic:"dynamax",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:20,spd:31,spe:31},ev_level:252},moves:["Spirit Break","Darkest Lariat","Bulk Up","Play Rough"]}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Grimmsnarl",lv:95,gender:"M",nature:"Adamant",ability:"Prankster",item:"Leftovers",mechanic:"dynamax",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Spirit Break","Darkest Lariat","Thunder Wave","Bulk Up"],isAce:true,friendship:{trust:180,passion:200,insight:140,devotion:120}},{name:"Morpeko",lv:92,gender:"F",nature:"Jolly",ability:"Hunger Switch",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Aura Wheel","Psychic Fangs","Seed Bomb","Protect"]},{name:"Obstagoon",lv:90,gender:"M",nature:"Jolly",ability:"Guts",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Facade","Knock Off","Obstruct","Close Combat"]},{name:"Scrafty",lv:90,gender:"M",nature:"Careful",ability:"Shed Skin",item:"Chesto Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Dragon Dance","Drain Punch","Crunch","Rest"]},{name:"Toxicroak",lv:88,gender:"M",nature:"Jolly",ability:"Dry Skin",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Drain Punch","Sucker Punch","Swords Dance"]},{name:"Liepard",lv:88,gender:"F",nature:"Jolly",ability:"Prankster",item:"Eject Button",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Encore","Thunder Wave","Foul Play","U-turn"]}]}};const HEX_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Duskull",lv:24,gender:"F",nature:"Sassy",ability:"Levitate",stats_meta:{ivs:{hp:20,atk:15,def:25,spa:15,spd:25,spe:10},ev_level:10},moves:["Night Shade","Disable","Will-O-Wisp","Shadow Sneak"]},{name:"Litwick",lv:24,gender:"F",nature:"Modest",ability:"Flash Fire",stats_meta:{ivs:{hp:20,atk:15,def:15,spa:25,spd:15,spe:20},ev_level:20},moves:["Ember","Hex","Minimize","Smog"]},{name:"Shuppet",lv:26,gender:"F",nature:"Adamant",ability:"Insomnia",isAce:true,item:"Spell Tag",stats_meta:{ivs:{hp:25,atk:25,def:20,spa:15,spd:20,spe:25},ev_level:40},moves:["Shadow Sneak","Knock Off","Curse","Screech"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Dusclops",lv:49,gender:"F",nature:"Relaxed",ability:"Pressure",item:"Eviolite",stats_meta:{ivs:{hp:31,atk:25,def:31,spa:20,spd:31,spe:0},ev_level:120},moves:["Trick Room","Curse","Pain Split","Ice Punch"]},{name:"Lampent",lv:48,gender:"F",nature:"Modest",ability:"Flame Body",stats_meta:{ivs:{hp:25,atk:0,def:25,spa:31,spd:25,spe:31},ev_level:85},moves:["Shadow Ball","Flamethrower","Confuse Ray","Energy Ball"]},{name:"Doublade",lv:48,gender:"F",nature:"Brave",ability:"No Guard",item:"Eviolite",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:25,spe:0},ev_level:85},moves:["Swords Dance","Shadow Sneak","Sacred Sword","Gyro Ball"]},{name:"Banette",lv:51,gender:"F",nature:"Adamant",ability:"Frisk",item:"Colbur Berry",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:25,spa:10,spd:25,spe:31},ev_level:180},moves:["Phantom Force","Sucker Punch","Will-O-Wisp","Destiny Bond"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Dusclops",lv:74,gender:"F",nature:"Sassy",ability:"Pressure",item:"Eviolite",stats_meta:{ivs:{hp:31,atk:25,def:31,spa:25,spd:31,spe:0},ev_level:252},moves:["Night Shade","Will-O-Wisp","Trick Room","Memento"]},{name:"Chandelure",lv:75,gender:"F",nature:"Modest",ability:"Infiltrator",item:"Choice Specs",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Overheat","Shadow Ball","Energy Ball","Trick"]},{name:"Cofagrigus",lv:72,gender:"M",nature:"Bold",ability:"Mummy",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Hex","Toxic Spikes","Protect","Body Press"]},{name:"Gothitelle",lv:73,gender:"F",nature:"Calm",ability:"Competitive",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:200},moves:["Psychic","Thunder Wave","Fake Out","Heal Pulse"]},{name:"Banette",lv:78,gender:"F",nature:"Adamant",ability:"Frisk",mechanic:"mega",item:"Banettite",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},isAce:true,friendship:{trust:100,passion:80,insight:220,devotion:120},moves:["Destiny Bond","Gunk Shot","Phantom Force","Knock Off"]}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:true,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Sableye",lv:90,gender:"F",nature:"Bold",ability:"Prankster",item:"Sablenite",mechanic:"mega",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Calm Mind","Recover","Will-O-Wisp","Shadow Ball"],isAce:true,friendship:{trust:120,passion:80,insight:255,devotion:120}},{name:"Dusclops",lv:88,gender:"F",nature:"Relaxed",ability:"Pressure",item:"Eviolite",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:0},ev_level:252},moves:["Night Shade","Pain Split","Will-O-Wisp","Trick Room"]},{name:"Chandelure",lv:88,gender:"F",nature:"Timid",ability:"Infiltrator",item:"Choice Scarf",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Fire Blast","Shadow Ball","Energy Ball","Trick"]},{name:"Banette",lv:87,gender:"F",nature:"Adamant",ability:"Insomnia",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Destiny Bond","Knock Off","Phantom Force"]},{name:"Gourgeist-Super",lv:86,gender:"F",nature:"Impish",ability:"Frisk",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Leech Seed","Protect","Poltergeist","Shadow Sneak"]},{name:"Meowstic-F",name:"Gothitelle",lv:86,gender:"F",nature:"Calm",ability:"Competitive",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Psychic","Thunder Wave","Cosmic Power","Stored Power"]}]}};const BEA_DATA={1:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Tyrogue",lv:24,gender:"M",nature:"Adamant",ability:"Guts",stats_meta:{ivs:{hp:20,atk:25,def:20,spa:15,spd:20,spe:20},ev_level:10},moves:["Mach Punch","Fake Out","Tackle","Focus Energy"]},{name:"Pancham",lv:25,gender:"M",nature:"Adamant",ability:"Iron Fist",item:"Muscle Band",stats_meta:{ivs:{hp:25,atk:25,def:25,spa:15,spd:25,spe:20},ev_level:20},moves:["Comet Punch","Circle Throw","Karate Chop","Work Up"]},{name:"Farfetch'd-Galar",lv:26,gender:"M",nature:"Brave",ability:"Scrappy",item:"Leek",isAce:true,stats_meta:{ivs:{hp:25,atk:25,def:25,spa:15,spd:25,spe:20},ev_level:40},moves:["Rock Smash","Peck","Fury Cutter","Focus Energy"]}]},2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Hitmontop",lv:48,gender:"M",nature:"Impish",ability:"Intimidate",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:20},ev_level:85},moves:["Fake Out","Rapid Spin","Close Combat","Sucker Punch"]},{name:"Pangoro",lv:49,gender:"M",nature:"Adamant",ability:"Iron Fist",stats_meta:{ivs:{hp:31,atk:31,def:25,spa:10,spd:25,spe:20},ev_level:85},moves:["Hammer Arm","Bullet Punch","Crunch","Ice Punch"]},{name:"Sirfetch'd",lv:50,gender:"M",nature:"Adamant",ability:"Scrappy",item:"Leek",stats_meta:{ivs:{hp:31,atk:31,def:25,spa:10,spd:25,spe:31},ev_level:120},moves:["Brick Break","Poison Jab","Leaf Blade","Swords Dance"]},{name:"Machamp",lv:52,gender:"M",nature:"Example",ability:"Guts",item:"Sitrus Berry",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:120},moves:["Cross Chop","Bullet Punch","Ice Punch","Knock Off"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Falinks",lv:73,gender:"N",nature:"Jolly",ability:"Defiant",item:"Sitrus Berry",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["No Retreat","Close Combat","Iron Head","Throat Chop"]},{name:"Grapploct",lv:74,gender:"M",nature:"Careful",ability:"Technician",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:20},ev_level:180},moves:["Octolock","Drain Punch","Sucker Punch","Protect"]},{name:"Hawlucha",lv:75,gender:"M",nature:"Jolly",ability:"Unburden",item:"White Herb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Close Combat","Acrobatics","Poison Jab","Swords Dance"]},{name:"Machamp",lv:78,gender:"M",nature:"Adamant",ability:"Guts",item:"Flame Orb",mechanic:"dynamax",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:10,spd:31,spe:31},ev_level:252},moves:["Facade","Close Combat","Thunder Punch","Bullet Punch"],friendship:{trust:160,passion:180,insight:100,devotion:120}}]},4:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:true,enable_tera:false},party:[{name:"Grapploct",lv:88,gender:"M",nature:"Careful",ability:"Limber",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Octolock","Protect","Drain Punch","Sucker Punch"]},{name:"Pangoro",lv:89,gender:"M",nature:"Adamant",ability:"Scrappy",item:"Choice Band",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Gunk Shot","Close Combat","Knock Off","Bullet Punch"]},{name:"Sirfetch'd",lv:90,gender:"M",nature:"Adamant",ability:"Scrappy",item:"Leek",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Meteor Assault","Brave Bird","Close Combat","Thousand Arrows (?)"]},{name:"Hawlucha",lv:90,gender:"M",nature:"Jolly",ability:"Mold Breaker",item:"Life Orb",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Swords Dance","Close Combat","Brave Bird","Roost"]},{name:"Falinks",lv:87,gender:"N",nature:"Jolly",ability:"Defiant",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["No Retreat","Close Combat","Throat Chop","Megahorn"]},{name:"Machamp",lv:95,gender:"M",nature:"Adamant",ability:"Guts",item:"Flame Orb",mechanic:"dynamax",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Facade","Close Combat","Heavy Slam","Stone Edge"],isAce:true,hasSecondWind:true,friendship:{trust:100,passion:200,insight:140,devotion:120}}]}};const CYNTHIA_DATA={2:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Spiritomb",lv:61,gender:"F",nature:"Quiet",ability:"Pressure",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:0},ev_level:85},moves:["Sucker Punch","Psychic","Shadow Ball","Embargo"]},{name:"Roserade",lv:60,gender:"F",nature:"Timid",ability:"Natural Cure",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:85},moves:["Sludge Bomb","Energy Ball","Shadow Ball","Extrasensory"]},{name:"Gastrodon",lv:60,gender:"F",nature:"Modest",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:85},moves:["Muddy Water","Earth Power","Sludge Bomb","Stone Edge"]},{name:"Lucario",lv:63,gender:"M",nature:"Naive",ability:"Inner Focus",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:120},moves:["Aura Sphere","Dragon Pulse","Extreme Speed","Close Combat"]},{name:"Milotic",lv:63,gender:"F",nature:"Bold",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:120},moves:["Hydro Pump","Ice Beam","Mirror Coat","Recover"]},{name:"Garchomp",lv:66,gender:"F",nature:"Jolly",ability:"Rough Skin",item:"Garchompite",mechanic:"mega",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Dragon Rush","Earthquake","Brick Break","Giga Impact"]}]},3:{unlocks:{enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Spiritomb",lv:80,gender:"F",nature:"Bold",ability:"Infiltrator",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:0},ev_level:180},moves:["Dream Eater","Dark Pulse","Hypnosis","Shadow Ball"]},{name:"Togekiss",lv:83,gender:"M",nature:"Timid",ability:"Serene Grace",item:"Leftovers",item:"Weakness Policy",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:180},moves:["Air Slash","Dazzling Gleam","Aura Sphere","Nasty Plot"]},{name:"Eelektross",lv:83,gender:"M",nature:"Quiet",item:"Assault Vest",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Wild Charge","Flamethrower","Giga Drain","Dragon Claw"]},{name:"Milotic",lv:84,gender:"F",nature:"Bold",ability:"Competitive",item:"Flame Orb",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Scald","Recover","Ice Beam","Mirror Coat"]},{name:"Lucario",lv:84,gender:"M",nature:"Naive",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Close Combat","Meteor Mash","Extreme Speed","Swords Dance"]},{name:"Garchomp",lv:88,gender:"F",nature:"Jolly",mechanic:"mega",item:"Garchompite",isAce:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Dragon Claw","Earthquake","Poison Jab","Swords Dance"]}]},4:{unlocks:{enable_bond:true,enable_styles:true,enable_insight:true,enable_mega:true,enable_z_move:false,enable_dynamax:false,enable_tera:false},party:[{name:"Spiritomb",lv:95,gender:"F",nature:"Bold",ability:"Infiltrator",item:"Kee Berry",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Hypnosis","Memento","Foul Play","Will-O-Wisp"]},{name:"Togekiss",lv:95,gender:"M",nature:"Timid",ability:"Serene Grace",item:"Choice Scarf",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Air Slash","Dazzling Gleam","Aura Sphere","Fire Blast"]},{name:"Milotic",lv:95,gender:"F",nature:"Bold",ability:"Competitive",item:"Leftovers",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Hydro Pump","Blizzard","Recover","Mirror Coat"]},{name:"Lucario",lv:96,gender:"M",nature:"Naughty",ability:"Justified",item:"Focus Sash",stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Swords Dance","Close Combat","Extreme Speed","Psychic"]},{name:"Volcarona",lv:96,gender:"F",nature:"Modest",ability:"Flame Body",item:"Heavy-Duty Boots",stats_meta:{ivs:{hp:31,atk:0,def:31,spa:31,spd:31,spe:31},ev_level:252},moves:["Quiver Dance","Fiery Dance","Bug Buzz","Giga Drain"]},{name:"Garchomp",lv:100,gender:"F",nature:"Naughty",mechanic:"mega",item:"Garchompite",isAce:true,hasSecondWind:true,stats_meta:{ivs:{hp:31,atk:31,def:31,spa:31,spd:31,spe:31},ev_level:{hp:0,atk:252,def:0,spa:100,spd:0,spe:158}},moves:["Earthquake","Stone Edge","Draco Meteor","Poison Jab"],friendship:{trust:255,passion:255,insight:255,devotion:200}}]}};if(typeof window!=="undefined"){window.GLORIA_DATA=GLORIA_DATA;window.SELENE_DATA=SELENE_DATA;window.ROSA_DATA=ROSA_DATA;window.DAWN_DATA=DAWN_DATA;window.AKARI_DATA=AKARI_DATA;window.SERENA_DATA=SERENA_DATA;window.LUSAMINE_DATA=LUSAMINE_DATA;window.LILLIE_DATA=LILLIE_DATA;window.MALLOW_DATA=MALLOW_DATA;window.LANA_DATA=LANA_DATA;window.IRIDA_DATA=IRIDA_DATA;window.SONIA_DATA=SONIA_DATA;window.ROXIE_DATA=ROXIE_DATA;window.IONO_DATA=IONO_DATA;window.ERIKA_DATA=ERIKA_DATA;window.NESSA_DATA=NESSA_DATA;window.MARNIE_DATA=MARNIE_DATA;window.HEX_DATA=HEX_DATA;window.BEA_DATA=BEA_DATA;window.CYNTHIA_DATA=CYNTHIA_DATA;window.JULIANA_DATA=JULIANA_DATA;window.TRAINER_GLOBALS={gloria:GLORIA_DATA,selene:SELENE_DATA,rosa:ROSA_DATA,dawn:DAWN_DATA,akari:AKARI_DATA,serena:SERENA_DATA,juliana:JULIANA_DATA,lusamine:LUSAMINE_DATA,lillie:LILLIE_DATA,mallow:MALLOW_DATA,lana:LANA_DATA,irida:IRIDA_DATA,sonia:SONIA_DATA,roxie:ROXIE_DATA,iono:IONO_DATA,erika:ERIKA_DATA,nessa:NESSA_DATA,marnie:MARNIE_DATA,hex:HEX_DATA,bea:BEA_DATA,cynthia:CYNTHIA_DATA}}const NPC_TRIGGERS={lusamine:["Lusamine","","","","",""],erika:["Erika","","",""],roxie:["Roxie","Homika","","",""],iono:["Iono","Nanjamo","","",""],marnie:["Marnie","Mary","","","",""],cynthia:["Cynthia","Shirona","","","","",""],bea:["Bea","Saito","",""],sonia:["Sonia","","",""],gloria:["Gloria","Yuuri","","","",""],rosa:["Rosa","Mei","","","",""],dawn:["Dawn","Hikari","",""],serena:["Serena","","","",""],irida:["Irida","Kai","","",""],akari:["Akari","Sho","",""],nessa:["Nessa","Rurina","",""],mallow:["Mallow","Mao","","","",""],lana:["Lana","Suiren","","",""],lillie:["Lillie","Lilie","","","",""],hex:["Hex Maniac","Occult Maniac","","","","Hex","HeXx",""],selene:["Selene","Mizuki","","","Moon"],juliana:["Juliana","Aoi","",""]};const NPC_ADDON_DATA={gloria:{name_cn:"",name_en:"Gloria",zone_affinity:{N:2,B:2,S:1,A:3,Z:2},unlock_key:"enable_dynamax",unlock_item:{name_cn:"",name_en:"Stickered Dynamax Band",emoji:"",desc:"",effect:" - ",dialogue:""},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},rosa:{name_cn:"",name_en:"Rosa",zone_affinity:{N:3,B:1,S:1,A:1,Z:2},unlock_key:"enable_bond",unlock_item:{name_cn:"",name_en:'The "Unbroken-Gem" Sync IEM',emoji:"",desc:"",effect:" - ",dialogue:""},relationship_stage:{negative:{"-2":{label:"NG",desc:""},"-1":{label:"",desc:"A"}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},dawn:{name_cn:"",name_en:"Dawn",zone_affinity:{N:2,B:2,S:1,A:1,Z:1},unlock_key:"enable_insight",unlock_item:{name_cn:"",name_en:"The Jammed-Button Poketch",emoji:"",desc:"MAX",effect:"/ - UI/",dialogue:""},relationship_stage:{negative:{"-2":{label:"",desc:'""'},"-1":{label:"",desc:'""'}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:'""'},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},akari:{name_cn:"",name_en:"Akari",zone_affinity:{N:1,B:2,S:3,A:1,Z:1},unlock_key:"enable_styles",unlock_item:{name_cn:"",name_en:"The Bitten Red Scarf",emoji:"",desc:"",effect:" - ",dialogue:""},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},serena:{name_cn:"",name_en:"Serena",zone_affinity:{N:2,B:2,S:1,A:1,Z:2},unlock_key:"enable_mega",unlock_item:{name_cn:"",name_en:"Blue Ribbon Key Stone Choker",emoji:"",desc:" Mega  (Key Stone)",effect:"Mega - ",dialogue:""},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},lusamine:{name_cn:"",name_en:"Lusamine",zone_affinity:{N:0,B:1,S:0,A:0,Z:3},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:'""'}},positive:{1:{label:"",desc:""},2:{label:"",desc:'""'},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},lillie:{name_cn:"",name_en:"Lillie",zone_affinity:{N:1,B:2,S:1,A:1,Z:3},relationship_stage:{negative:{"-2":{label:"",desc:'""'},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},mallow:{name_cn:"",name_en:"Mallow",zone_affinity:{N:1,B:3,S:0,A:0,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:'""'},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},lana:{name_cn:"",name_en:"Lana",zone_affinity:{N:1,B:3,S:0,A:0,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},irida:{name_cn:"",name_en:"Irida",zone_affinity:{N:0,B:0,S:0,A:1,Z:3},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:'""'}}},love_thresholds:{1:20,2:40,3:60,4:80}},sonia:{name_cn:"",name_en:"Sonia",zone_affinity:{N:1,B:1,S:0,A:0,Z:3},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},roxie:{name_cn:"",name_en:"Roxie",zone_affinity:{N:3,B:0,S:2,A:0,Z:0},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:'""'},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},iono:{name_cn:"",name_en:"Iono",zone_affinity:{N:3,B:1,S:1,A:2,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:"anti"},"-1":{label:"",desc:"/"}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},erika:{name_cn:"",name_en:"Erika",zone_affinity:{N:0,B:3,S:0,A:1,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},nessa:{name_cn:"",name_en:"Nessa",zone_affinity:{N:1,B:3,S:0,A:2,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},marnie:{name_cn:"",name_en:"Marnie",zone_affinity:{N:2,B:1,S:3,A:0,Z:0},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},hex:{name_cn:"",name_en:"Hex Maniac",zone_affinity:{N:0,B:0,S:3,A:0,Z:0},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},bea:{name_cn:"",name_en:"Bea",zone_affinity:{N:2,B:0,S:0,A:3,Z:1},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},cynthia:{name_cn:"",name_en:"Cynthia",zone_affinity:{N:2,B:2,S:2,A:2,Z:2},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}},selene:{name_cn:"",name_en:"Selene",zone_affinity:{N:1,B:3,S:1,A:2,Z:1},unlock_key:"enable_z_move",unlock_item:{name_cn:"Z",name_en:"Selene's Spare Z-Power Ring",emoji:"",desc:" Z SELENE",effect:"Z - Z",dialogue:"~"},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:""},3:{label:"",desc:""},4:{label:"",desc:"Z"}}},love_thresholds:{1:20,2:40,3:60,4:80}},juliana:{name_cn:"",name_en:"Juliana",zone_affinity:{N:2,B:2,S:2,A:2,Z:2},unlock_key:"enable_tera",unlock_item:{name_cn:"",name_en:"Heavy Cargo & Tera Orb",emoji:"",desc:"18",effect:" -  <> ",dialogue:""},relationship_stage:{negative:{"-2":{label:"",desc:""},"-1":{label:"",desc:""}},neutral:{0:{label:"",desc:""}},positive:{1:{label:"",desc:""},2:{label:"",desc:"Switch"},3:{label:"",desc:""},4:{label:"",desc:""}}},love_thresholds:{1:20,2:40,3:60,4:80}}};const ZONE_DATA={N:{name_cn:"",name_en:"Neon District",security:"B",security_note:"",landmarks:" / LiveHouse<> /  / 24h",mist:"",dominant_desc:{iono:"",roxie:"",rosa:""},avoid_reasons:{erika:"",hex:"..................",irida:"......",lusamine:""}},B:{name_cn:"",name_en:"Bloom District",security:"A-",security_note:"",landmarks:" / (SPA) /  / ",mist:"98%",dominant_desc:{erika:"",nessa:"T",mallow:"",lana:"",selene:""},avoid_reasons:{roxie:"",hex:"()",bea:"......",irida:"(Z)"}},S:{name_cn:"",name_en:"Shadow District",security:"D",security_note:"",landmarks:" /  /  / ",mist:"",dominant_desc:{marnie:"",hex:"",akari:""},avoid_reasons:{erika:"......",lusamine:"",lillie:"()",mallow:"",lana:"()",irida:"()",sonia:"........."}},A:{name_cn:"",name_en:"Apex District",security:"B+",security_note:"",landmarks:" /  /  / ",mist:"",dominant_desc:{bea:"",gloria:"",cynthia:""},avoid_reasons:{mallow:"",lana:"()",hex:"(............)",sonia:"......",roxie:"Live",lusamine:"",marnie:"()"}},Z:{name_cn:"",name_en:"Zenith Central",security:"S",security_note:"",landmarks:"() /  / PC / ",mist:"",dominant_desc:{lusamine:"",irida:"()",sonia:"",lillie:""},avoid_reasons:{roxie:"",hex:"(......)",akari:"......",marnie:"()"}}};function getZoneCharacters(zoneCode){const zone=ZONE_DATA[zoneCode];const result={dominant:[],active:[],occasional:[],rare:[]};for(const[npcId,data]of Object.entries(NPC_ADDON_DATA)){if(!data.zone_affinity)continue;const affinity=data.zone_affinity[zoneCode]||0;const entry={id:npcId,name_cn:data.name_cn,name_en:data.name_en,affinity:affinity,desc:zone?.dominant_desc?.[npcId]||null,avoid_reason:zone?.avoid_reasons?.[npcId]||null};if(affinity===3)result.dominant.push(entry);else if(affinity===2)result.active.push(entry);else if(affinity===1)result.occasional.push(entry);else result.rare.push(entry)}return result}function generateZoneStatusCard(zoneCode){const zone=ZONE_DATA[zoneCode];if(!zone)return`[: ${zoneCode}]`;const chars=getZoneCharacters(zoneCode);let card=`<pkm_zone_info>\n[LOC]   ${zone.name_cn} (${zone.name_en})\n: ${zone.security} - ${zone.security_note}\n: ${zone.landmarks}\n: ${zone.mist}\n---\n[] (=3):`;chars.dominant.forEach(c=>{const desc=c.desc?`: ${c.desc}`:"";card+=`\n  ${c.name_cn}(${c.name_en})${desc}`});if(chars.active.length>0){card+=`\n[] (=2): ${chars.active.map(c=>c.name_cn).join(" / ")}`}if(chars.occasional.length>0){card+=`\n[] (=1): ${chars.occasional.map(c=>c.name_cn).join(" / ")}`}if(chars.rare.length>0){card+=`\n[] (=0):`;chars.rare.forEach(c=>{const reason=c.avoid_reason?` - ${c.avoid_reason}`:"";card+=`\n  ${c.name_cn}${reason}`})}card+=`\n---\n: \n</pkm_zone_info>`;return card}if(typeof window!=="undefined"){window.NPC_TRIGGERS=NPC_TRIGGERS;window.NPC_ADDON_DATA=NPC_ADDON_DATA;window.ZONE_DATA=ZONE_DATA;window.getZoneCharacters=getZoneCharacters;window.generateZoneStatusCard=generateZoneStatusCard}(async function(){"use strict";const PLUGIN_NAME="[PKM]";const PKM_BATTLE_TAG="PKM_BATTLE";const PKM_INJECT_ID="pkm_player_data";let lastHandledMk=null;let isProcessing=false;console.log(`${PLUGIN_NAME} ...`);function wait(ms){return new Promise(resolve=>setTimeout(resolve,ms))}async function getEraVars(){return new Promise((resolve,reject)=>{const timeout=setTimeout(()=>{console.warn(`${PLUGIN_NAME} ERA `);resolve(null)},5e3);eventOn("era:queryResult",detail=>{if(detail.queryType==="getCurrentVars"){clearTimeout(timeout);resolve(detail.result?.statWithoutMeta||null)}},{once:true});eventEmit("era:getCurrentVars")})}async function updateEraVars(data){return new Promise(async resolve=>{const currentVars=await getEraVars();const nestedData={};for(const[path,value]of Object.entries(data)){const parts=path.split(".");let current=nestedData;if(path.includes("stats_meta")&&typeof value==="object"&&value.ev_level!==undefined){const currentEvLevel=_.get(currentVars,`${path}.ev_level`,0);const newEvLevel=value.ev_level;console.log(`${PLUGIN_NAME} [EV_LEVEL] : ${path}, : ${currentEvLevel}, AI: ${newEvLevel}`);if(newEvLevel<currentEvLevel){value.ev_level=currentEvLevel+newEvLevel;console.log(`${PLUGIN_NAME} [EV_LEVEL] : ${currentEvLevel} + ${newEvLevel} = ${value.ev_level}`)}else{console.log(`${PLUGIN_NAME} [EV_LEVEL] : ${currentEvLevel} -> ${newEvLevel}`)}}for(let i=0;i<parts.length-1;i++){const part=parts[i];if(!current[part]){current[part]={}}current=current[part]}current[parts[parts.length-1]]=value}console.log(`${PLUGIN_NAME} [DEBUG]  ERA :`,JSON.stringify(nestedData,null,2));eventEmit("era:updateByObject",nestedData);setTimeout(()=>{console.log(`${PLUGIN_NAME} [DEBUG] ERA `);resolve()},100)})}function insertEraVars(data){eventEmit("era:insertByObject",data)}async function getPlayerParty(){const eraVars=await getEraVars();if(!eraVars)return null;const playerData=_.get(eraVars,"pkm.player",null);return playerData}function createEmptySlot(slotNum){return{slot:slotNum,name:null,nickname:null,species:null,gender:null,lv:null,quality:null,nature:null,ability:null,shiny:false,item:null,moves:{move1:null,move2:null,move3:null,move4:null},stats_meta:{ivs:{hp:null,atk:null,def:null,spa:null,spd:null,spe:null},ev_level:null},notes:null}}function getAllPokemon(playerData){const partyPokemon=parsePartyData(playerData?.party);const reservePokemon=parsePartyData(playerData?.reserve);return[...partyPokemon,...reservePokemon]}async function setPlayerParty(mode,input=null){console.warn(`${PLUGIN_NAME} setPlayerParty  VariableEdit `);const eraVars=await getEraVars();const playerData=_.get(eraVars,"pkm.player",{name:"",party:{slot1:createEmptySlot(1),slot2:createEmptySlot(2),slot3:createEmptySlot(3),slot4:createEmptySlot(4),slot5:createEmptySlot(5),slot6:createEmptySlot(6)},reserve:{}});const allPokemon=getAllPokemon(playerData);switch(mode){case"single":if(typeof input==="string"){const found=allPokemon.find(p=>p.name?.toLowerCase()===input.toLowerCase()||p.nickname?.toLowerCase()===input.toLowerCase());if(found){updateEraVars({"pkm.player.party.slot1":found});console.log(`${PLUGIN_NAME}   ${found.name}  slot1`);return found}else{console.warn(`${PLUGIN_NAME} : ${input}`);return null}}break;default:console.warn(`${PLUGIN_NAME}  ${mode}  VariableEdit`);return null}return null}function stripJsonComments(jsonStr){let result="";let i=0;let inString=false;let stringChar=null;while(i<jsonStr.length){const char=jsonStr[i];const nextChar=jsonStr[i+1];if(!inString&&(char==='"'||char==="'")){inString=true;stringChar=char;result+=char;i++;continue}if(inString){result+=char;if(char==="\\"&&nextChar){result+=nextChar;i+=2;continue}if(char===stringChar){inString=false;stringChar=null}i++;continue}if(char==="/"&&nextChar==="/"){i+=2;while(i<jsonStr.length&&jsonStr[i]!=="\n"&&jsonStr[i]!=="\r"){i++}continue}if(char==="/"&&nextChar==="*"){i+=2;while(i<jsonStr.length-1){if(jsonStr[i]==="*"&&jsonStr[i+1]==="/"){i+=2;break}i++}continue}result+=char;i++}return result}function extractJsonCandidate(rawText){if(!rawText)return null;const trimmed=rawText.trim();if(!trimmed)return null;if(trimmed.startsWith("{")||trimmed.startsWith("[")){const closingChar=trimmed.startsWith("{")?"}":"]";const endIndex=trimmed.lastIndexOf(closingChar);if(endIndex!==-1){return trimmed.slice(0,endIndex+1)}return trimmed}const braceIndex=trimmed.indexOf("{");let startIndex=-1;let closingChar=null;if(braceIndex!==-1){startIndex=braceIndex;closingChar="}"}else{const bracketIndex=trimmed.indexOf("[");if(bracketIndex!==-1){startIndex=bracketIndex;closingChar="]"}}if(startIndex===-1){return null}const sliced=trimmed.slice(startIndex);const endIndex=closingChar?sliced.lastIndexOf(closingChar):-1;if(endIndex!==-1){return sliced.slice(0,endIndex+1)}return sliced}function parseAiBattleOutput(messageText){let cleanedText=messageText;cleanedText=cleanedText.replace(/[\s\S]*<\/planning>/gi,"");cleanedText=cleanedText.replace(/[\s\S]*<\/think>/gi,"");const regex=new RegExp(`<${PKM_BATTLE_TAG}>([\\s\\S]*?)<\\/${PKM_BATTLE_TAG}>`,"gi");let match=null;let latestMatch=null;while((match=regex.exec(cleanedText))!==null){latestMatch=match}if(!latestMatch)return null;try{const jsonStr=extractJsonCandidate(latestMatch[1]);if(!jsonStr){throw new Error("JSON")}console.log(`${PLUGIN_NAME} JSON:`,jsonStr.substring(0,100)+"...");const jsonWithoutComments=stripJsonComments(jsonStr);const battleData=JSON.parse(jsonWithoutComments);console.log(`${PLUGIN_NAME} AI:`,battleData);return normalizeP1P2Format(battleData)}catch(e){console.error(`${PLUGIN_NAME} AI:`,e);return null}}function extractPokemonFromTrainerDB(trainerName,pokemonNames,tier=2){console.log(`${PLUGIN_NAME} [DEBUG] : ${trainerName}, : ${pokemonNames.join(", ")}, Tier: ${tier}`);const playerKeywords=["player","","","","{{user}}","user"];const normalizedName=trainerName.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"");const isPlayer=playerKeywords.some(kw=>normalizedName.includes(kw)||trainerName.includes(kw))||trainerName==="{{user}}"||trainerName.includes("{{user}}");if(isPlayer){console.log(`${PLUGIN_NAME} [DEBUG] "${trainerName}"  ERA `);return{party:[],unlocks:null}}const db=getTrainerDatabase();const aliasMap={hexmaniac:"hex",ionostreamer:"iono",nanjamo:"iono",hikari:"dawn",mei:"rosa",yuuri:"gloria"};const matchedKey=aliasMap[normalizedName]||normalizedName;console.log(`${PLUGIN_NAME} [DEBUG] : "${trainerName}" -> "${normalizedName}" -> "${matchedKey}"`);const trainerData=db[matchedKey];if(!trainerData){console.log(`${PLUGIN_NAME} [DEBUG]  "${trainerName}" `);console.log(`${PLUGIN_NAME} [DEBUG] :`,Object.keys(db).join(", "));return{party:[],unlocks:null}}const validTier=Math.max(1,Math.min(4,tier));let tierData=trainerData[validTier];let usedTier=validTier;const extractPartyFromTierData=data=>{if(!data)return null;if(Array.isArray(data))return data;if(data.party&&Array.isArray(data.party))return data.party;return null};const extractUnlocksFromTierData=data=>{if(!data)return null;if(Array.isArray(data))return null;if(data.unlocks)return data.unlocks;return null};let party=extractPartyFromTierData(tierData);let unlocks=extractUnlocksFromTierData(tierData);if(!party){const availableTiers=Object.keys(trainerData).filter(k=>/^\d+$/.test(k)).map(Number).sort((a,b)=>a-b);console.log(`${PLUGIN_NAME} [DEBUG]  "${trainerName}"  Tier ${validTier}: ${availableTiers.join(", ")}`);if(availableTiers.length>0){if(validTier===3&&!availableTiers.includes(3)&&availableTiers.includes(4)){usedTier=4;console.log(`${PLUGIN_NAME} [] Tier 3  Tier 4`)}else if(validTier===1&&!availableTiers.includes(1)&&matchedKey==="cynthia"&&availableTiers.includes(2)){usedTier=2;console.log(`${PLUGIN_NAME} [] Cynthia  Tier 1 Tier 2`)}else{usedTier=availableTiers.reduce((prev,curr)=>Math.abs(curr-validTier)<Math.abs(prev-validTier)?curr:prev);console.log(`${PLUGIN_NAME} [DEBUG]  Tier ${usedTier} `)}tierData=trainerData[usedTier];party=extractPartyFromTierData(tierData);unlocks=extractUnlocksFromTierData(tierData)}}if(!party){console.log(`${PLUGIN_NAME} [DEBUG]  "${trainerName}" `);return{party:[],unlocks:null}}console.log(`${PLUGIN_NAME} [DEBUG] ${trainerName} Tier ${usedTier} :`,party.map(p=>p.name).join(", "));if(unlocks){console.log(`${PLUGIN_NAME} [DEBUG] ${trainerName} Tier ${usedTier} unlocks:`,unlocks)}if(!pokemonNames||pokemonNames.length===0){console.log(`${PLUGIN_NAME} [DEBUG]  ${trainerName}  (${party.length} )`);return{party:party,unlocks:unlocks}}const extracted=[];for(const pokemonName of pokemonNames){const normalizedPokemonName=pokemonName.toLowerCase().replace(/[^a-z0-9]/g,"");const found=party.find(p=>{const pName=(p.name||"").toLowerCase().replace(/[^a-z0-9]/g,"");return pName===normalizedPokemonName||pName.includes(normalizedPokemonName)||normalizedPokemonName.includes(pName)});if(found){extracted.push(found);console.log(`${PLUGIN_NAME} [DEBUG]   ${trainerName} : ${found.name}, mechanic: ${found.mechanic||"null"}`)}else{console.warn(`${PLUGIN_NAME} [DEBUG]   ${trainerName} : ${pokemonName} tier `);extracted.push({name:pokemonName,_needGenerate:true,_tier:tier})}}return{party:extracted,unlocks:unlocks}}function detectTrainerType(name,type=""){const normalizedName=(name||"").toLowerCase().replace(/[^a-z0-9]/g,"");const playerKeywords=["player","","","user"];const isPlayer=playerKeywords.some(kw=>normalizedName.includes(kw))||name==="{{user}}"||name.includes("{{user}}");if(isPlayer){return"player"}if(type.toLowerCase()==="wild"||normalizedName.includes("wild")||//.test(name||"")){return"wild"}const db=getTrainerDatabase();const aliasMap={hexmaniac:"hex",ionostreamer:"iono",nanjamo:"iono",hikari:"dawn",mei:"rosa",yuuri:"gloria"};const matchedKey=aliasMap[normalizedName]||normalizedName;if(db[matchedKey]){return"db_trainer"}return"generated_trainer"}function processTrainerParty(trainer,defaultTier=2){const trainerName=trainer.name||"Unknown";const tier=trainer.tier||defaultTier;const trainerType=detectTrainerType(trainerName,trainer.type||"");console.log(`${PLUGIN_NAME} [DOUBLE] : ${trainerName}, : ${trainerType}, Tier: ${tier}`);const playerKeywords=["player","","","{{user}}","user"];const isPlayer=playerKeywords.some(kw=>trainerName.toLowerCase().includes(kw.toLowerCase()))||trainerName==="{{user}}"||trainerName.includes("{{user}}");let resolvedParty=[];let dbUnlocks=null;if(isPlayer){console.log(`${PLUGIN_NAME} [DOUBLE] "${trainerName}"  ERA `);resolvedParty=trainer.party||[]}else if(trainerType==="db_trainer"){if(trainer.party&&Array.isArray(trainer.party)){const hasDetailedParty=trainer.party.some(p=>typeof p==="object"&&(p.lv!==undefined||p.moves!==undefined));if(hasDetailedParty){console.log(`${PLUGIN_NAME} [DOUBLE] ${trainerName}  AI `);resolvedParty=trainer.party.map(p=>{if(typeof p==="string")return{name:p,_needGenerate:true,_tier:tier};return{...p,_needGenerate:true,_tier:tier}});const dbResult=extractPokemonFromTrainerDB(trainerName,[],tier);dbUnlocks=dbResult.unlocks}else{const pokemonNames=trainer.party.map(p=>typeof p==="string"?p:p.name);const dbResult=extractPokemonFromTrainerDB(trainerName,pokemonNames,tier);const dbPokemon=dbResult.party||dbResult;dbUnlocks=dbResult.unlocks;if(dbPokemon.length>0){resolvedParty=dbPokemon}else{console.log(`${PLUGIN_NAME} [DOUBLE] `);resolvedParty=trainer.party.map(p=>{if(typeof p==="string")return{name:p,_needGenerate:true,_tier:tier};return{...p,_needGenerate:true,_tier:tier}})}}}else{const dbResult=lookupTrainerFromDB(trainerName,tier);if(dbResult&&dbResult.party){resolvedParty=dbResult.party;dbUnlocks=dbResult.unlocks}}if(dbUnlocks){console.log(`${PLUGIN_NAME} [DOUBLE] ${trainerName}  unlocks:`,dbUnlocks)}}else if(trainerType==="wild"){console.log(`${PLUGIN_NAME} [DOUBLE]  AI `);resolvedParty=(trainer.party||[]).map(p=>{if(typeof p==="string")return{name:p,_needGenerate:true,_tier:tier};return{...p,_needGenerate:true,_tier:tier}})}else{console.log(`${PLUGIN_NAME} [DOUBLE] NPC "${trainerName}" AI `);resolvedParty=(trainer.party||[]).map(p=>{if(typeof p==="string")return{name:p,_needGenerate:true,_tier:tier};return{...p,_needGenerate:true,_tier:tier}})}const autoDetectedUnlocks=detectUnlocksFromParty(resolvedParty);const finalUnlocks=mergeUnlocks(trainer.unlocks,dbUnlocks,autoDetectedUnlocks);console.log(`${PLUGIN_NAME} [DOUBLE] ${trainerName}  unlocks:`,finalUnlocks);return{name:trainerName,party:resolvedParty,trainerType:trainerType,isPlayer:isPlayer,tier:tier,unlocks:finalUnlocks,lines:trainer.lines}}function detectUnlocksFromParty(party){const detected={enable_mega:false,enable_dynamax:false,enable_tera:false,enable_z_move:false};if(!Array.isArray(party))return detected;for(const pokemon of party){const mechanic=(pokemon.mechanic||"").toLowerCase();if(mechanic==="mega")detected.enable_mega=true;if(mechanic==="dynamax"||mechanic==="gmax")detected.enable_dynamax=true;if(mechanic==="tera")detected.enable_tera=true;if(mechanic==="z_move"||mechanic==="zmove"||mechanic==="z")detected.enable_z_move=true}return detected}function mergeUnlocks(...unlocksList){const merged={enable_bond:false,enable_styles:false,enable_insight:false,enable_mega:false,enable_z_move:false,enable_dynamax:false,enable_tera:false};for(const unlocks of unlocksList){if(!unlocks)continue;for(const key of Object.keys(merged)){if(unlocks[key]===true){merged[key]=true}}}return merged}function mergeTrainerParties(trainersData){const allParty=[];const trainerMetadata=[];const names=[];trainersData.forEach(t=>{names.push(t.name);t.party.forEach(p=>{allParty.push(p);trainerMetadata.push(t.name)})});if(allParty.length>6){console.log(`${PLUGIN_NAME} [DOUBLE] 6 (${allParty.length})6`);const indices=allParty.map((_,i)=>i);for(let i=indices.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[indices[i],indices[j]]=[indices[j],indices[i]]}const keepIndices=indices.slice(0,6).sort((a,b)=>a-b);const trimmedParty=keepIndices.map(i=>allParty[i]);const trimmedMetadata=keepIndices.map(i=>trainerMetadata[i]);console.log(`${PLUGIN_NAME} [DOUBLE] : ${trimmedParty.map(p=>typeof p==="string"?p:p.name).join(", ")}`);return{party:trimmedParty,trainerMetadata:trimmedMetadata,names:names.join(" & ")}}return{party:allParty,trainerMetadata:trainerMetadata,names:names.join(" & ")}}function normalizeP1P2Format(battleData){if(battleData.player||battleData.enemy){return battleData}if(!battleData.p1&&!battleData.p2){return battleData}console.log(`${PLUGIN_NAME} ==========  ==========`);const normalized={difficulty:battleData.difficulty||"normal",battle_type:battleData.battle_type||"double"};const defaultTier=battleData.tier||2;if(battleData.p1){const p1Entrants=battleData.p1.entrants||battleData.p1.trainers;if(p1Entrants&&Array.isArray(p1Entrants)){console.log(`${PLUGIN_NAME} [P1] : ${p1Entrants.length} `);const trainersData=p1Entrants.map(t=>processTrainerParty(t,defaultTier));const merged=mergeTrainerParties(trainersData);console.log(`${PLUGIN_NAME} [P1]  unlocks:`,trainersData.map(t=>({name:t.name,unlocks:t.unlocks})));const mergedUnlocks=mergeUnlocks(...trainersData.map(t=>t.unlocks));console.log(`${PLUGIN_NAME} [P1]  unlocks:`,mergedUnlocks);normalized.player={name:merged.names,party:merged.party,_trainerMetadata:merged.trainerMetadata,_trainersData:trainersData,unlocks:battleData.p1.unlocks||mergedUnlocks};console.log(`${PLUGIN_NAME} [P1] : ${merged.names}, : ${merged.party.map(p=>typeof p==="string"?p:p.name).join(", ")}`)}else{normalized.player=battleData.p1}}if(battleData.p2){const p2Entrants=battleData.p2.entrants||battleData.p2.trainers;if(p2Entrants&&Array.isArray(p2Entrants)){console.log(`${PLUGIN_NAME} [P2] : ${p2Entrants.length} `);const trainersData=p2Entrants.map(t=>processTrainerParty(t,defaultTier));const merged=mergeTrainerParties(trainersData);const hasWild=trainersData.some(t=>t.trainerType==="wild");const allDbTrainers=trainersData.every(t=>t.trainerType==="db_trainer");const firstWithLines=trainersData.find(t=>t.lines);const mergedUnlocks=mergeUnlocks(...trainersData.map(t=>t.unlocks));normalized.enemy={type:hasWild?"wild":"trainer",name:merged.names,party:merged.party,_trainerMetadata:merged.trainerMetadata,_trainersData:trainersData,lines:battleData.p2.lines||(firstWithLines?firstWithLines.lines:{}),unlocks:battleData.p2.unlocks||mergedUnlocks,_allDbTrainers:allDbTrainers};console.log(`${PLUGIN_NAME} [P2] : ${merged.names}, : ${normalized.enemy.type}`)}else{const trainerData=processTrainerParty({name:battleData.p2.name,party:battleData.p2.party,tier:battleData.p2.tier||defaultTier,type:battleData.p2.type,unlocks:battleData.p2.unlocks,lines:battleData.p2.lines},defaultTier);normalized.enemy={type:trainerData.trainerType==="wild"?"wild":"trainer",name:trainerData.name,party:trainerData.party,lines:battleData.p2.lines||{},unlocks:battleData.p2.unlocks||trainerData.unlocks,tier:battleData.p2.tier};console.log(`${PLUGIN_NAME} [P2] : ${trainerData.name}, : ${trainerData.trainerType}`)}}console.log(`${PLUGIN_NAME} ==========  ==========`);return normalized}function sanitizeMoves(moves){if(!Array.isArray(moves))return[];return moves.map(m=>typeof m==="string"?m.trim():"").filter(Boolean).slice(0,4)}function autoDetectSpecialForm(pokemonName){if(!pokemonName)return null;const name=pokemonName.toLowerCase().trim();if(name==="kyogre"||name==="groudon"){return"primal"}if(name==="zacian"||name==="zamazenta"){return"crowned"}return null}const NATURES=["Hardy","Lonely","Brave","Adamant","Naughty","Bold","Docile","Relaxed","Impish","Lax","Timid","Hasty","Serious","Jolly","Naive","Modest","Mild","Quiet","Bashful","Rash","Calm","Gentle","Sassy","Careful","Quirky"];function getTrainerDatabase(){const db={};const trainerGlobals=[["gloria","GLORIA_DATA"],["selene","SELENE_DATA"],["rosa","ROSA_DATA"],["dawn","DAWN_DATA"],["akari","AKARI_DATA"],["serena","SERENA_DATA"],["juliana","JULIANA_DATA"],["lusamine","LUSAMINE_DATA"],["lillie","LILLIE_DATA"],["mallow","MALLOW_DATA"],["lana","LANA_DATA"],["irida","IRIDA_DATA"],["sonia","SONIA_DATA"],["roxie","ROXIE_DATA"],["iono","IONO_DATA"],["erika","ERIKA_DATA"],["nessa","NESSA_DATA"],["marnie","MARNIE_DATA"],["hex","HEX_DATA"],["bea","BEA_DATA"],["cynthia","CYNTHIA_DATA"]];const missing=[];trainerGlobals.forEach(([key,globalName])=>{if(typeof window[globalName]!=="undefined"){db[key]=window[globalName]}else{missing.push(globalName)}});if(missing.length>0){console.warn(`${PLUGIN_NAME} [DEBUG] :`,missing.join(", "))}return db}function generateRandomIVs(quality="normal"){const roll=()=>Math.floor(Math.random()*32);switch(quality){case"low":return{hp:Math.floor(Math.random()*16),atk:Math.floor(Math.random()*16),def:Math.floor(Math.random()*16),spa:Math.floor(Math.random()*16),spd:Math.floor(Math.random()*16),spe:Math.floor(Math.random()*16)};case"high":const highIvs={hp:roll(),atk:roll(),def:roll(),spa:roll(),spd:roll(),spe:roll()};const stats=["hp","atk","def","spa","spd","spe"];const perfectStats=stats.sort(()=>Math.random()-.5).slice(0,3);perfectStats.forEach(s=>highIvs[s]=31);return highIvs;case"perfect":return{hp:31,atk:31,def:31,spa:31,spd:31,spe:31};default:return{hp:roll(),atk:roll(),def:roll(),spa:roll(),spd:roll(),spe:roll()}}}function getRandomNature(){return NATURES[Math.floor(Math.random()*NATURES.length)]}function normalizePokemonName(rawName){if(!rawName)return"";let name=String(rawName).trim();const adjectiveMap=[{pattern:/-Alolan$/i,replacement:"-Alola"},{pattern:/\s+Alolan$/i,replacement:"-Alola"},{pattern:/-Galarian$/i,replacement:"-Galar"},{pattern:/\s+Galarian$/i,replacement:"-Galar"},{pattern:/-Hisuian$/i,replacement:"-Hisui"},{pattern:/\s+Hisuian$/i,replacement:"-Hisui"},{pattern:/-Paldean$/i,replacement:"-Paldea"},{pattern:/\s+Paldean$/i,replacement:"-Paldea"}];for(const{pattern:pattern,replacement:replacement}of adjectiveMap){if(pattern.test(name)){name=name.replace(pattern,replacement);console.log(`${PLUGIN_NAME} [NORMALIZE] "${rawName}" -> "${name}"`);break}}return name}function getPokemonDataSafe(pokemonName){if(!pokemonName||typeof POKEDEX==="undefined")return null;const normalizedName=normalizePokemonName(pokemonName);let id=normalizedName.toLowerCase().replace(/[^a-z0-9]/g,"");if(POKEDEX[id]){return{data:POKEDEX[id],usedName:normalizedName,fallbackType:"direct"}}const suffixFixes=[{from:"alolan",to:"alola"},{from:"galarian",to:"galar"},{from:"hisuian",to:"hisui"},{from:"paldean",to:"paldea"}];for(const fix of suffixFixes){if(id.endsWith(fix.from)){const fixedId=id.slice(0,-fix.from.length)+fix.to;if(POKEDEX[fixedId]){console.log(`${PLUGIN_NAME} [SUFFIX FIX] "${id}" -> "${fixedId}"`);return{data:POKEDEX[fixedId],usedName:normalizedName,fallbackType:"suffix_fix"}}}}console.warn(`${PLUGIN_NAME} [FALLBACK] Data missing for "${pokemonName}" (normalized: "${normalizedName}", id: "${id}"). Trying base form...`);const splitChars=["-"," "];for(const splitChar of splitChars){if(normalizedName.includes(splitChar)){const potentialBaseName=normalizedName.split(splitChar)[0];if(potentialBaseName&&potentialBaseName!==normalizedName){const baseId=potentialBaseName.toLowerCase().replace(/[^a-z0-9]/g,"");if(POKEDEX[baseId]){console.log(`${PLUGIN_NAME} [FALLBACK SUCCESS] Using base species "${potentialBaseName}" (id: "${baseId}") instead of "${normalizedName}"`);return{data:POKEDEX[baseId],usedName:potentialBaseName,fallbackType:"base_form"}}}}}console.error(`${PLUGIN_NAME} [FATAL] Pokemon "${pokemonName}" totally unknown. No fallback available.`);return null}function getRandomAbility(pokemonName){if(typeof POKEDEX==="undefined")return null;const result=getPokemonDataSafe(pokemonName);if(!result||!result.data||!result.data.abilities)return null;const data=result.data;const abilities=[];if(data.abilities["0"])abilities.push(data.abilities["0"]);if(data.abilities["1"])abilities.push(data.abilities["1"]);if(data.abilities["H"]&&Math.random()<.2){abilities.push(data.abilities["H"])}if(abilities.length===0)return null;return abilities[Math.floor(Math.random()*abilities.length)]}function getRandomMoves(pokemonName,level=50){if(typeof POKEDEX==="undefined"||typeof MOVES==="undefined"){return["Tackle","Scratch","Growl","Leer"]}const result=getPokemonDataSafe(pokemonName);if(!result||!result.data)return["Tackle","Scratch","Growl","Leer"];const data=result.data;const pokemonTypes=data.types||["Normal"];const candidateMoves=[];for(const moveId in MOVES){const move=MOVES[moveId];if(!move||move.category==="Status")continue;if(pokemonTypes.includes(move.type)||move.type==="Normal"){if(move.basePower&&move.basePower>0&&move.basePower<=100){candidateMoves.push(move.name)}}}const shuffled=candidateMoves.sort(()=>Math.random()-.5);return shuffled.slice(0,4)}function getTierDefaultLevel(tier){const tierLevelMap={1:25,2:50,3:75,4:85};return tierLevelMap[tier]||50}function generateWildPokemon(baseData,tier=null,isCustomNpc=false){const rawName=baseData.name||"Rattata";const name=normalizePokemonName(rawName);let level=baseData.lv||baseData.level;if(!level&&tier){level=getTierDefaultLevel(tier);console.log(`${PLUGIN_NAME} [GEN]  tier ${tier} : ${level}`)}if(!level){level=5}const shiny=baseData.shiny!==undefined?baseData.shiny:Math.random()<1/4096;let ivQuality=baseData.quality;if(!ivQuality){const isLegendary=["mewtwo","mew","lugia","hooh","rayquaza","dialga","palkia","giratina","reshiram","zekrom","kyurem","xerneas","yveltal","zygarde","solgaleo","lunala","necrozma","zacian","zamazenta","eternatus","koraidon","miraidon"].includes(name.toLowerCase().replace(/[^a-z0-9]/g,""));ivQuality=shiny?"high":isLegendary?"high":level>=50?"medium":"low"}const qualityMap={low:"low",medium:"normal",high:"high",perfect:"perfect"};const ivs=generateRandomIVs(qualityMap[ivQuality]||ivQuality);let evLevel=0;if(isCustomNpc){const evLevelMap={low:Math.min(30,Math.floor(level*.3)),medium:Math.min(100,Math.floor(level*.8)),high:Math.min(200,Math.floor(level*1.5)),perfect:252};evLevel=evLevelMap[ivQuality]||Math.min(30,Math.floor(level*.5))}const finalName=name;console.log(`${PLUGIN_NAME} [GEN] Pokemon name normalized: "${rawName}" -> "${finalName}"`);const nature=baseData.nature||getRandomNature();const ability=baseData.ability||getRandomAbility(finalName);const moves=baseData.moves&&baseData.moves.length>0?sanitizeMoves(baseData.moves):getRandomMoves(finalName,level);const gender=baseData.gender||(Math.random()>.5?"M":"F");const autoForm=autoDetectSpecialForm(finalName);return{name:finalName,gender:gender,lv:level,nature:nature,ability:ability,shiny:shiny,item:baseData.item||null,mechanic:baseData.mechanic||null,teraType:baseData.teraType||null,stats_meta:{ivs:ivs,ev_level:evLevel},moves:moves,mega:baseData.mega||autoForm}}function lookupTrainerFromDB(trainerName,tier=2){const db=getTrainerDatabase();const normalizedName=trainerName.toLowerCase().replace(/[^a-z0-9]/g,"");const aliasMap={hexmaniac:"hex",hexgirl:"hex",ionostreamer:"iono",nanjamo:"iono","champion cynthia":"cynthia",championcynthia:"cynthia",shirona:"cynthia","gym leader nessa":"nessa",gymleadernessa:"nessa","gym leader bea":"bea",gymleaderbea:"bea","gym leader erika":"erika",gymleadererika:"erika","gym leader marnie":"marnie",gymleadermarnie:"marnie","professor sonia":"sonia",professorsonia:"sonia","captain mallow":"mallow",captainmallow:"mallow","captain lana":"lana",captainlana:"lana","aether president lusamine":"lusamine",presidentlusamine:"lusamine",hikari:"dawn",mei:"rosa","serena kalos":"serena",yuuri:"gloria",gloriagalar:"gloria"};let matchedKey=normalizedName;if(!db[normalizedName]){if(aliasMap[normalizedName]){matchedKey=aliasMap[normalizedName];console.log(`${PLUGIN_NAME} [DEBUG] : "${normalizedName}" -> "${matchedKey}"`)}else{const dbKeys=Object.keys(db);const partialMatch=dbKeys.find(key=>normalizedName.includes(key)||key.includes(normalizedName));if(partialMatch){matchedKey=partialMatch;console.log(`${PLUGIN_NAME} [DEBUG] : "${normalizedName}" -> "${matchedKey}"`)}}}const trainerData=db[matchedKey];if(!trainerData){console.log(`${PLUGIN_NAME}  "${trainerName}" (${normalizedName}) `);return null}const validTier=Math.max(1,Math.min(4,tier));let tierData=trainerData[validTier];let usedTier=validTier;const extractParty=data=>{if(!data)return null;if(Array.isArray(data))return data;if(data.party&&Array.isArray(data.party))return data.party;return null};const extractUnlocks=data=>{if(!data)return null;if(Array.isArray(data))return null;if(data.unlocks)return data.unlocks;return null};let party=extractParty(tierData);let unlocks=extractUnlocks(tierData);if(!party||party.length===0){const availableTiers=Object.keys(trainerData).filter(k=>/^\d+$/.test(k)).map(Number).sort((a,b)=>a-b);console.log(`${PLUGIN_NAME} [DEBUG]  "${trainerName}"  Tier ${validTier}: ${availableTiers.join(", ")}`);if(availableTiers.length>0){if(validTier===3&&!availableTiers.includes(3)&&availableTiers.includes(4)){usedTier=4;console.log(`${PLUGIN_NAME} [] Tier 3  Tier 4`)}else if(validTier===1&&!availableTiers.includes(1)&&matchedKey==="cynthia"&&availableTiers.includes(2)){usedTier=2;console.log(`${PLUGIN_NAME} [] Cynthia  Tier 1 Tier 2`)}else{usedTier=availableTiers.reduce((prev,curr)=>Math.abs(curr-validTier)<Math.abs(prev-validTier)?curr:prev);console.log(`${PLUGIN_NAME} [DEBUG]  Tier ${usedTier} `)}tierData=trainerData[usedTier];party=extractParty(tierData);unlocks=extractUnlocks(tierData)}if(!party||party.length===0){console.warn(`${PLUGIN_NAME}  "${trainerName}" `);return null}}const difficultyMap={1:"easy",2:"hard",3:"expert",4:"expert"};console.log(`${PLUGIN_NAME}   "${trainerName}" Tier ${usedTier} `);if(unlocks){console.log(`${PLUGIN_NAME} [DEBUG] ${trainerName} unlocks:`,unlocks)}return{party:party,unlocks:unlocks,difficulty:difficultyMap[usedTier]||"normal"}}function resolveEnemyData(enemySource,aiBattleData){const rawType=(enemySource.type||"").toString().toLowerCase();const isWild=rawType==="wild";const enemyName=enemySource.name||(isWild?"wild":"Trainer");const enemyLines=enemySource.lines||{};const enemyId=enemySource.id||enemyName;const tier=enemySource.tier||aiBattleData.tier||1;if(enemySource._trainersData&&Array.isArray(enemySource._trainersData)){console.log(`${PLUGIN_NAME} `);const trainersWithParty=enemySource._trainersData.map(trainerData=>{const isCustomNpc=trainerData.trainerType!=="wild"&&trainerData.trainerType!=="db_trainer";let trainerParty=trainerData.party.map(p=>{if(p._needGenerate){const pokemonTier=p._tier||trainerData.tier||tier;const isWild=trainerData.trainerType==="wild";console.log(`${PLUGIN_NAME} [P2]  ${trainerData.name} : ${p.name} (Tier ${pokemonTier}, ${isWild?"":"NPC"})`);return generateWildPokemon(p,pokemonTier,!isWild)}return p});trainerParty.sort((a,b)=>(b.lv||0)-(a.lv||0));return{name:trainerData.name,party:trainerParty,originalCount:trainerParty.length}});const totalCount=trainersWithParty.reduce((sum,t)=>sum+t.originalCount,0);const finalParty=[];if(totalCount<=6){trainersWithParty.forEach(t=>{finalParty.push(...t.party);console.log(`${PLUGIN_NAME} [P2] ${t.name} : ${t.party.map(p=>p.name).join(", ")}`)})}else{console.log(`${PLUGIN_NAME} [P2]  ${totalCount} > 6`);const allocations=trainersWithParty.map(t=>{const ratio=t.originalCount/totalCount;const allocated=Math.max(1,Math.round(ratio*6));return{...t,allocated:allocated}});let totalAllocated=allocations.reduce((sum,a)=>sum+a.allocated,0);while(totalAllocated>6){const maxAlloc=allocations.filter(a=>a.allocated>1).sort((a,b)=>b.allocated-a.allocated)[0];if(maxAlloc){maxAlloc.allocated--;totalAllocated--}else break}allocations.forEach(alloc=>{const selected=alloc.party.slice(0,alloc.allocated);finalParty.push(...selected);console.log(`${PLUGIN_NAME} [P2] ${alloc.name}  ${alloc.allocated}/${alloc.originalCount} : ${selected.map(p=>`${p.name}(Lv${p.lv})`).join(", ")}`)})}const autoDetectedUnlocks=detectUnlocksFromParty(finalParty);const finalUnlocks=mergeUnlocks(enemySource.unlocks,autoDetectedUnlocks);return{party:finalParty,type:enemySource.type||"trainer",name:enemyName,id:enemyId,lines:enemyLines,unlocks:finalUnlocks,difficulty:aiBattleData.difficulty||"normal"}}const aiProvidedParty=Array.isArray(enemySource.party)&&enemySource.party.length>0;const hasDetailedParty=aiProvidedParty&&enemySource.party.some(p=>typeof p==="object"&&(p.lv!==undefined||p.moves!==undefined));if(hasDetailedParty){const isCustomNpc=!isWild;console.log(`${PLUGIN_NAME} AI  AI ${isWild?"":"NPC"}`);const generatedParty=enemySource.party.map(p=>{const baseData=typeof p==="string"?{name:p}:p;const pokemonTier=baseData._tier||tier;return generateWildPokemon(baseData,pokemonTier,isCustomNpc)});const autoDetectedUnlocks=detectUnlocksFromParty(generatedParty);const finalUnlocks=mergeUnlocks(enemySource.unlocks,autoDetectedUnlocks);return{party:generatedParty,type:isWild?"wild":"trainer",name:enemyName,id:enemyId,lines:enemyLines,unlocks:finalUnlocks,difficulty:aiBattleData.difficulty||"normal"}}if(!isWild&&enemyName&&enemyName!=="wild"){const dbResult=lookupTrainerFromDB(enemyName,tier);if(dbResult){let finalParty=dbResult.party;if(aiProvidedParty){console.log(`${PLUGIN_NAME}  ${enemyName} Tier ${tier} : ${enemySource.party.join(", ")}`);const requestedNames=enemySource.party.map(p=>typeof p==="string"?p.toLowerCase():(p.name||"").toLowerCase());finalParty=dbResult.party.filter(pokemon=>requestedNames.includes((pokemon.name||"").toLowerCase()));if(finalParty.length===0){console.warn(`${PLUGIN_NAME} `);finalParty=dbResult.party}}return{party:finalParty,type:"trainer",name:enemyName,id:enemyId,lines:enemyLines,unlocks:dbResult.unlocks||null,difficulty:aiBattleData.difficulty||dbResult.difficulty}}}if(aiProvidedParty){const isCustomNpc=!isWild;console.log(`${PLUGIN_NAME}  AI ${isWild?"":"NPC"}`);const generatedParty=enemySource.party.map(p=>{const baseData=typeof p==="string"?{name:p}:p;const pokemonTier=baseData._tier||tier;return generateWildPokemon(baseData,pokemonTier,isCustomNpc)});const autoDetectedUnlocks=detectUnlocksFromParty(generatedParty);const finalUnlocks=mergeUnlocks(enemySource.unlocks,autoDetectedUnlocks);return{party:generatedParty,type:isWild?"wild":"trainer",name:enemyName,id:enemyId,lines:enemyLines,unlocks:finalUnlocks,difficulty:aiBattleData.difficulty||"normal"}}console.log(`${PLUGIN_NAME} `);let rawParty=Array.isArray(aiBattleData.party)&&aiBattleData.party.length>0?aiBattleData.party:[];if(rawParty.length===0){rawParty=[{name:enemyName!=="wild"?enemyName:"Rattata",lv:5}]}const isCustomNpc=!isWild;const generatedParty=rawParty.map(p=>{const baseData=typeof p==="string"?{name:p}:p;const pokemonTier=baseData._tier||tier;return generateWildPokemon(baseData,pokemonTier,isCustomNpc)});return{party:generatedParty,type:isWild?"wild":"trainer",name:enemyName,id:enemyId,lines:enemyLines,unlocks:null,difficulty:aiBattleData.difficulty||(isWild?"easy":"normal")}}function parsePartyData(party){console.log(`${PLUGIN_NAME} [DEBUG] parsePartyData :`,typeof party,party);if(!party)return[];let partyArray=[];if(!Array.isArray(party)&&typeof party==="object"){const slotKeys=Object.keys(party).filter(k=>/^slot\d+$/.test(k)).sort((a,b)=>{const numA=parseInt(a.replace("slot",""));const numB=parseInt(b.replace("slot",""));return numA-numB});if(slotKeys.length>0){partyArray=slotKeys.map(k=>party[k]);console.log(`${PLUGIN_NAME} [DEBUG] :`,partyArray.length,"")}else{const numKeys=Object.keys(party).filter(k=>/^\d+$/.test(k)).sort((a,b)=>Number(a)-Number(b));if(numKeys.length>0){partyArray=numKeys.map(k=>party[k]);console.log(`${PLUGIN_NAME} [DEBUG] :`,partyArray)}else if(party.name){partyArray=[party]}else{return[]}}}else if(Array.isArray(party)){partyArray=party}else{return[]}return partyArray.map((p,index)=>{if(!p)return null;if(typeof p==="string"){try{const parsed=JSON.parse(p);return normalizePokemonData(parsed,index)}catch(e){console.warn(`${PLUGIN_NAME} :`,p);return null}}if(p&&typeof p==="object"&&p["0"]!==undefined&&typeof p["0"]==="string"){const keys=Object.keys(p).filter(k=>/^\d+$/.test(k)).sort((a,b)=>Number(a)-Number(b));const jsonStr=keys.map(k=>p[k]).join("");console.log(`${PLUGIN_NAME} [DEBUG]  JSON:`,jsonStr.substring(0,50)+"...");try{const parsed=JSON.parse(jsonStr);return normalizePokemonData(parsed,index)}catch(e){console.warn(`${PLUGIN_NAME}  JSON :`,e);return null}}return normalizePokemonData(p,index)}).filter(p=>p!==null&&p.name)}function normalizePokemonData(pokemon,slotIndex){if(!pokemon||typeof pokemon!=="object")return null;let moves=[];if(pokemon.moves){if(Array.isArray(pokemon.moves)){moves=sanitizeMoves(pokemon.moves)}else if(typeof pokemon.moves==="object"){moves=sanitizeMoves([pokemon.moves.move1,pokemon.moves.move2,pokemon.moves.move3,pokemon.moves.move4])}}return{...pokemon,slot:pokemon.slot||slotIndex+1,moves:moves}}function isCompletePokemonData(pokemon){if(!pokemon||typeof pokemon!=="object")return false;return pokemon.name&&typeof pokemon.lv==="number"&&Array.isArray(pokemon.moves)&&pokemon.moves.length>0}function selectPokemonByNames(playerParty,nameList){if(!playerParty||!Array.isArray(playerParty))return[];if(!nameList||!Array.isArray(nameList))return[];console.log(`${PLUGIN_NAME} [DEBUG] :`,nameList);console.log(`${PLUGIN_NAME} [DEBUG] :`,playerParty.map(p=>p.name||p.nickname));const result=[];for(const name of nameList){const normalizedName=(typeof name==="string"?name:name?.name||"").toLowerCase();let found=playerParty.find(p=>p.name?.toLowerCase()===normalizedName||p.nickname?.toLowerCase()===normalizedName);if(!found){const baseName=normalizedName.split("-")[0];found=playerParty.find(p=>{const pokemonName=(p.name||"").toLowerCase();const pokemonBaseName=pokemonName.split("-")[0];return pokemonBaseName===baseName||pokemonName.includes(normalizedName)||normalizedName.includes(pokemonName)});if(found){console.log(`${PLUGIN_NAME} [DEBUG] : "${name}" -> "${found.name}"`)}}if(found){result.push(found)}else{console.warn(`${PLUGIN_NAME} : ${name}`)}}console.log(`${PLUGIN_NAME} [DEBUG] :`,result.map(p=>p.name));return result}function resolveTrainerParty(aiTrainerConfig,eraPlayerData,role="trainer"){const trainerName=aiTrainerConfig?.name||eraPlayerData?.name||"";const playerKeywords=["player","","","","{{user}}","user"];const normalizedName=trainerName.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"");const isPlayer=playerKeywords.some(kw=>normalizedName.includes(kw)||trainerName.includes(kw))||trainerName==="{{user}}"||trainerName.includes("{{user}}");console.log(`${PLUGIN_NAME} [${role}] : "${trainerName}", : ${isPlayer}`);const isDoubleBattle=trainerName.includes("&");if(isDoubleBattle&&aiTrainerConfig._trainersData&&Array.isArray(aiTrainerConfig._trainersData)){console.log(`${PLUGIN_NAME} [${role}] `);const eraParty=parsePartyData(eraPlayerData?.party);const trainersWithParty=aiTrainerConfig._trainersData.map(trainerData=>{let trainerParty=[];if(trainerData.isPlayer){if(trainerData.party&&trainerData.party.length>0){trainerParty=trainerData.party.map(p=>{const pokemonName=typeof p==="string"?p:p?.name;return selectPokemonByNames(eraParty,[pokemonName])[0]}).filter(Boolean)}else{trainerParty=eraParty}}else{const isWild=trainerData.trainerType==="wild";trainerParty=trainerData.party.map(p=>{if(p._needGenerate){const pokemonTier=p._tier||trainerData.tier||2;console.log(`${PLUGIN_NAME} [${role}]  ${trainerData.name} : ${p.name} (Tier ${pokemonTier}, ${isWild?"":"NPC"})`);return generateWildPokemon(p,pokemonTier,!isWild)}console.log(`${PLUGIN_NAME} [${role}] : ${p.name}, mechanic: ${p.mechanic||"null"}, _needGenerate: ${p._needGenerate}`);return p})}trainerParty.sort((a,b)=>(b.lv||0)-(a.lv||0));return{name:trainerData.name,party:trainerParty,originalCount:trainerParty.length}});const totalCount=trainersWithParty.reduce((sum,t)=>sum+t.originalCount,0);const finalParty=[];if(totalCount<=6){trainersWithParty.forEach(t=>{finalParty.push(...t.party);console.log(`${PLUGIN_NAME} [${role}] ${t.name} : ${t.party.map(p=>p.name).join(", ")}`)})}else{console.log(`${PLUGIN_NAME} [${role}]  ${totalCount} > 6`);const allocations=trainersWithParty.map(t=>{const ratio=t.originalCount/totalCount;const allocated=Math.max(1,Math.round(ratio*6));return{...t,allocated:allocated}});let totalAllocated=allocations.reduce((sum,a)=>sum+a.allocated,0);while(totalAllocated>6){const maxAlloc=allocations.filter(a=>a.allocated>1).sort((a,b)=>b.allocated-a.allocated)[0];if(maxAlloc){maxAlloc.allocated--;totalAllocated--}else break}allocations.forEach(alloc=>{const selected=alloc.party.slice(0,alloc.allocated);finalParty.push(...selected);console.log(`${PLUGIN_NAME} [${role}] ${alloc.name}  ${alloc.allocated}/${alloc.originalCount} : ${selected.map(p=>`${p.name}(Lv${p.lv})`).join(", ")}`)})}const autoDetectedUnlocks=detectUnlocksFromParty(finalParty);const trainerUnlocks=aiTrainerConfig._trainersData.map(t=>t.unlocks).filter(Boolean);const mergedUnlocks=mergeUnlocks(aiTrainerConfig.unlocks,autoDetectedUnlocks,...trainerUnlocks);console.log(`${PLUGIN_NAME} [${role}] aiTrainerConfig.unlocks:`,aiTrainerConfig.unlocks);console.log(`${PLUGIN_NAME} [${role}]  unlocks:`,trainerUnlocks);console.log(`${PLUGIN_NAME} [${role}]  unlocks:`,autoDetectedUnlocks);console.log(`${PLUGIN_NAME} [${role}]  unlocks:`,mergedUnlocks);finalParty.forEach(p=>{if(p.mechanic){console.log(`${PLUGIN_NAME} [${role}] finalParty  ${p.name}  mechanic: ${p.mechanic}`)}});return{name:trainerName,unlocks:mergedUnlocks,party:finalParty}}const eraParty=parsePartyData(eraPlayerData?.party);if(!aiTrainerConfig?.party||!Array.isArray(aiTrainerConfig.party)||aiTrainerConfig.party.length===0){if(isPlayer){console.log(`${PLUGIN_NAME} [${role}] : `);return{name:trainerName,unlocks:null,party:eraParty.length>0?eraParty:[{name:"Pikachu",lv:5,moves:["Thunder Shock","Quick Attack"]}]}}else{console.log(`${PLUGIN_NAME} [${role}] : NPCparty`);const dbResult=extractPokemonFromTrainerDB(trainerName,[],2);const dbParty=dbResult.party||dbResult;const dbUnlocks=dbResult.unlocks||null;if(dbParty.length>0){return{name:trainerName,unlocks:dbUnlocks,party:dbParty}}else{if(role==="p1"&&eraParty.length>0){console.log(`${PLUGIN_NAME} [${role}] NPC "${trainerName}"  role=p1 ERA `);return{name:trainerName,unlocks:null,party:eraParty}}console.warn(`${PLUGIN_NAME} [${role}] NPC "${trainerName}" `);return{name:trainerName,unlocks:null,party:[{name:"Pikachu",lv:5,moves:["Thunder Shock","Quick Attack"]}]}}}}const aiParty=aiTrainerConfig.party;const trainerMetadata=aiTrainerConfig._trainerMetadata||[];const hasCompleteData=aiParty.some(p=>isCompletePokemonData(p));const hasStringData=aiParty.some(p=>typeof p==="string");if(hasCompleteData&&!hasStringData){console.log(`${PLUGIN_NAME} [${role}] : AI`);const partyWithMega=aiParty.map((p,index)=>({...p,moves:sanitizeMoves(p.moves),mega:p.mega,trainer:trainerMetadata[index]}));return{name:trainerName,unlocks:null,party:partyWithMega}}if(hasCompleteData&&hasStringData){console.log(`${PLUGIN_NAME} [${role}] : `);const finalParty=[];for(let i=0;i<aiParty.length;i++){const p=aiParty[i];if(isCompletePokemonData(p)){finalParty.push({...p,moves:sanitizeMoves(p.moves),trainer:trainerMetadata[i]})}else{const pokemonName=typeof p==="string"?p:p?.name;let found=null;if(isPlayer&&eraParty.length>0){found=selectPokemonByNames(eraParty,[pokemonName])[0]}else{const dbResult=extractPokemonFromTrainerDB(trainerName,[pokemonName],2);const dbParty=dbResult.party||dbResult;found=dbParty[0]}if(found){finalParty.push({...found,trainer:trainerMetadata[i]})}else{console.warn(`${PLUGIN_NAME} [${role}] : ${pokemonName}`)}}}return{name:trainerName,unlocks:null,party:finalParty}}console.log(`${PLUGIN_NAME} [${role}] : `);const nameList=aiParty.map(p=>typeof p==="string"?p:p?.name).filter(Boolean);let selectedParty=[];let trainerUnlocks=null;if(isPlayer&&eraParty.length>0){selectedParty=selectPokemonByNames(eraParty,nameList)}else{const dbResult=extractPokemonFromTrainerDB(trainerName,nameList,2);selectedParty=dbResult.party||dbResult;trainerUnlocks=dbResult.unlocks||null;if(selectedParty.length===0&&role==="p1"&&eraParty.length>0){console.log(`${PLUGIN_NAME} [${role}] NPC "${trainerName}"  role=p1 ERA `);selectedParty=selectPokemonByNames(eraParty,nameList)}}if(selectedParty.length===0){console.warn(`${PLUGIN_NAME} [${role}] `);if((isPlayer||role==="p1")&&eraParty.length>0){console.log(`${PLUGIN_NAME} [${role}]  ERA `);selectedParty=eraParty}else{selectedParty=[{name:"Pikachu",lv:5,moves:["Thunder Shock","Quick Attack"]}]}}if(isDoubleBattle){console.log(`${PLUGIN_NAME} [${role}] : ${trainerName}`);if(trainerMetadata.length>0){const partyWithTrainers=selectedParty.map((pokemon,index)=>({...pokemon,trainer:trainerMetadata[index]||trainerName.split("&")[0].trim()}));return{name:trainerName,unlocks:trainerUnlocks,party:partyWithTrainers}}else{const trainerNames=trainerName.split("&").map(n=>n.trim());const midPoint=Math.ceil(selectedParty.length/2);const partyWithTrainers=selectedParty.map((pokemon,index)=>({...pokemon,trainer:index<midPoint?trainerNames[0]:trainerNames[1]||trainerNames[0]}));return{name:trainerName,unlocks:trainerUnlocks,party:partyWithTrainers}}}return{name:trainerName,unlocks:trainerUnlocks,party:selectedParty}}async function buildCompleteBattleJson(aiBattleData){const eraPlayerData=await getPlayerParty();if(!eraPlayerData||!eraPlayerData.party||eraPlayerData.party.length===0){console.warn(`${PLUGIN_NAME} ERANPC`)}const p1Source=aiBattleData.player||aiBattleData.p1||{};const p2Source=aiBattleData.enemy||aiBattleData.p2||{};const resolvedPlayer=resolveTrainerParty(p1Source,eraPlayerData,"p1");const resolvedEnemy=resolveEnemyData(p2Source,aiBattleData);const playerUnlocks=mergeUnlocks(resolvedPlayer.unlocks,eraPlayerData?.unlocks);const enemyUnlocks=resolvedEnemy.unlocks||null;const defaultSettings={enableAVS:true,enableCommander:true,enableEVO:true,enableBGM:true,enableSFX:true};const eraSettings=eraPlayerData?.settings||{};const aiSettings=aiBattleData?.settings||{};const finalSettings={...defaultSettings,...eraSettings,...aiSettings};const trainerProficiency=eraPlayerData?.trainerProficiency||0;const completeBattle={settings:finalSettings,difficulty:resolvedEnemy.difficulty||aiBattleData.difficulty||"normal",player:{name:resolvedPlayer.name,trainerProficiency:trainerProficiency,party:resolvedPlayer.party,unlocks:playerUnlocks},enemy:{id:resolvedEnemy.id,type:resolvedEnemy.type,name:resolvedEnemy.name,lines:resolvedEnemy.lines,unlocks:enemyUnlocks},party:resolvedEnemy.party,script:aiBattleData.script||null};console.log(`${PLUGIN_NAME} JSON:`,completeBattle);console.log(`${PLUGIN_NAME} [SETTINGS] :`,finalSettings);console.log(`${PLUGIN_NAME} [PROFICIENCY] :`,trainerProficiency);console.log(`${PLUGIN_NAME} [UNLOCK] player unlocks:`,playerUnlocks);if(enemyUnlocks){console.log(`${PLUGIN_NAME} [UNLOCK] enemy unlocks:`,enemyUnlocks)}return completeBattle}async function injectBattleFrontend(messageId,battleJson){try{const messages=getChatMessages(messageId);if(!messages||messages.length===0)return false;const msg=messages[0];let content=msg.message;const normalizePokemonFormat=pokemon=>{if(!pokemon)return pokemon;if(pokemon.friendship&&pokemon.friendship.avs){pokemon.avs={...pokemon.friendship.avs};delete pokemon.friendship}else if(pokemon.friendship&&!pokemon.friendship.avs){if(typeof pokemon.friendship==="object"&&("trust"in pokemon.friendship||"passion"in pokemon.friendship)){pokemon.avs={...pokemon.friendship};delete pokemon.friendship}}if(!pokemon.avs){pokemon.avs={trust:0,passion:0,insight:0,devotion:0}}if(pokemon.mechanic){console.log(`${PLUGIN_NAME} [MECHANIC] ${pokemon.name}: ${pokemon.mechanic}${pokemon.teraType?` (${pokemon.teraType})`:""}`)}if(pokemon.isAce!==undefined){pokemon.isAce=Boolean(pokemon.isAce)}if(pokemon.isLead!==undefined){pokemon.isLead=Boolean(pokemon.isLead);if(pokemon.isLead){console.log(`${PLUGIN_NAME} [LEAD] ${pokemon.name} marked as lead Pokemon`)}}return pokemon};if(battleJson.player&&battleJson.player.party){battleJson.player.party=battleJson.player.party.map(normalizePokemonFormat)}if(battleJson.party){battleJson.party=battleJson.party.map(normalizePokemonFormat)}const frontendPayload=`<PKM_FRONTEND>\n${JSON.stringify(battleJson)}\n</PKM_FRONTEND>`;content=content.trim()+"\n\n"+frontendPayload;await setChatMessages([{message_id:messageId,message:content}],{refresh:"affected"});console.log(`${PLUGIN_NAME}   #${messageId}`);return true}catch(e){console.error(`${PLUGIN_NAME} :`,e);return false}}function resetState(reason){console.log(`${PLUGIN_NAME} ${reason} -> `);lastHandledMk=null;isProcessing=false}function formatIVsDisplay(ivs){if(!ivs)return"???";const stats=["hp","atk","def","spa","spd","spe"];let perfectCount=0;let zeroAtk=false;for(const stat of stats){const val=ivs[stat];if(val===31)perfectCount++;if(stat==="atk"&&val===0)zeroAtk=true}if(perfectCount===6)return"6V";if(perfectCount===5&&zeroAtk)return"5V0A";if(perfectCount>=4)return`${perfectCount}V`;return`${perfectCount}V`}function formatGender(gender){if(gender==="M")return"";if(gender==="F")return"";return""}function generateIVsByQuality(quality){const targets={low:90,medium:120,high:150,perfect:186};const targetSum=targets[quality]||targets["low"];if(quality==="perfect"){return{hp:31,atk:31,def:31,spa:31,spd:31,spe:31}}const stats=["hp","atk","def","spa","spd","spe"];const ivs={};let remaining=targetSum;for(let i=0;i<stats.length;i++){const stat=stats[i];if(i===stats.length-1){ivs[stat]=Math.min(31,Math.max(0,remaining))}else{const maxForThis=Math.min(31,remaining-(stats.length-i-1)*0);const minForThis=Math.max(0,remaining-(stats.length-i-1)*31);ivs[stat]=Math.floor(Math.random()*(maxForThis-minForThis+1))+minForThis;remaining-=ivs[stat]}}return ivs}function isValidIVs(ivs){if(!ivs||typeof ivs!=="object")return false;const requiredStats=["hp","atk","def","spa","spd","spe"];return requiredStats.every(stat=>typeof ivs[stat]==="number"&&ivs[stat]>=0&&ivs[stat]<=31)}function autoFillStatsMeta(pokemon){const statsMeta=pokemon.stats_meta||{};let ivs=statsMeta.ivs;let evLevel=statsMeta.ev_level;if(!isValidIVs(ivs)){const quality=pokemon.quality||pokemon.iv_quality||null;if(quality&&["low","medium","high","perfect"].includes(quality)){ivs=generateIVsByQuality(quality)}else{const rand=Math.random();let randomQuality;if(rand<.3)randomQuality="low";else if(rand<.7)randomQuality="medium";else if(rand<.95)randomQuality="high";else randomQuality="perfect";ivs=generateIVsByQuality(randomQuality)}console.log(`${PLUGIN_NAME} [IVs]  ${pokemon.name}  IVs:`,ivs)}else{console.log(`${PLUGIN_NAME} [IVs] ${pokemon.name}  IVs`)}const lv=typeof pokemon.lv==="number"?pokemon.lv:typeof pokemon.level==="number"?pokemon.level:5;const calculatedEV=Math.min(252,Math.floor(lv*2.5));if(evLevel===undefined||evLevel===null){evLevel=calculatedEV}else{evLevel=Math.max(evLevel,calculatedEV)}return{ivs:ivs,ev_level:evLevel}}function generatePlayerDataPrompt(playerData){const parsedParty=parsePartyData(playerData?.party);if(!playerData||parsedParty.length===0){return null}const playerName=playerData?.name||"";const bonds=playerData?.bonds||{};const unlocks=playerData?.unlocks||{};const partyCount=parsedParty.length;const partyLines=Array.from({length:6}).map((_,idx)=>{const slotNum=idx+1;const pokemon=parsedParty.find(p=>(p.slot||slotNum)===slotNum);if(!pokemon){return`slot${slotNum}. `}const name=pokemon.nickname||pokemon.name||`Pokemon ${slotNum}`;const level=typeof pokemon.lv==="number"?pokemon.lv:typeof pokemon.level==="number"?pokemon.level:"??";const gender=formatGender(pokemon.gender);const nature=pokemon.nature||"???";const ability=pokemon.ability||"???";const filledStatsMeta=autoFillStatsMeta(pokemon);const ivs=filledStatsMeta.ivs;const evLevel=filledStatsMeta.ev_level;const ivsDisplay=formatIVsDisplay(ivs);const avs=pokemon.avs||{trust:0,passion:0,insight:0,devotion:0};const avsTotal=(avs.trust||0)+(avs.passion||0)+(avs.insight||0)+(avs.devotion||0);const avsDisplay=avsTotal>0?`T:${avs.trust||0}/P:${avs.passion||0}/I:${avs.insight||0}/D:${avs.devotion||0}`:"0/0/0/0";const moves=Array.isArray(pokemon.moves)&&pokemon.moves.length>0?pokemon.moves:[];const movesCount=moves.length;const movesDetailed=Array.from({length:4}).map((_,moveIdx)=>{const moveName=moves[moveIdx]||"";return`move${moveIdx+1}: ${moveName}`}).join(" | ");return`slot${slotNum}. ${gender} ${name} (Lv.${level})\n    [Nature: ${nature}] [Ability: ${ability}]\n    [Stats: ${ivsDisplay}] [EVs: ${evLevel}] [AVs: ${avsDisplay}]\n    Moves (${movesCount}/4): ${movesDetailed}`}).join("\n\n");const unlocksDisplay=[];if(unlocks.enable_mega)unlocksDisplay.push("Mega");if(unlocks.enable_z_move)unlocksDisplay.push("Z");if(unlocks.enable_dynamax)unlocksDisplay.push("Dmax");if(unlocks.enable_tera)unlocksDisplay.push("Tera");if(unlocks.enable_bond)unlocksDisplay.push("Bond");if(unlocks.enable_styles)unlocksDisplay.push("Style");if(unlocks.enable_insight)unlocksDisplay.push("Insight");const unlocksStr=unlocksDisplay.length>0?unlocksDisplay.join("/"):"";const bondItems=[];const unlockItems=[];if(bonds.enable_bond){bondItems.push(`     [] Rosa []\n     [] \n      :  - ****HP/`)}else if(unlocks.enable_bond){unlockItems.push(`    (Bond) [] - : `)}if(bonds.enable_styles){bondItems.push(`     [] Akari []\n     [] \n      :  - `)}else if(unlocks.enable_styles){unlockItems.push(`   / (Style) [] - : `)}if(bonds.enable_insight){bondItems.push(`     [] Dawn []\n     [] MAX\n      :   - `)}else if(unlocks.enable_insight){unlockItems.push(`    [] - : `)}if(bonds.enable_mega){bondItems.push(`    [] Serena []\n     [] \n      :   - MegaMEGA`)}else if(unlocks.enable_mega){unlockItems.push(`   Mega [] - : `)}if(bonds.enable_z_move){bondItems.push(`   Z [] Selene []\n     [] \n      :  (Break Limit) - ZMegaZ`)}else if(unlocks.enable_z_move){unlockItems.push(`   Z [] - : Z`)}if(bonds.enable_dynamax){bondItems.push(`     [] Gloria []\n     [] \n      :  - ****`)}else if(unlocks.enable_dynamax){unlockItems.push(`    [] - : `)}if(bonds.enable_tera){bondItems.push(`     [] Juliana []\n     [] *18*\n      :  - `)}else if(unlocks.enable_tera){unlockItems.push(`    [] - : `)}let inventorySection="";if(bondItems.length>0||unlockItems.length>0){inventorySection="\n   \n";if(bondItems.length>0){inventorySection+=` \n${bondItems.join("\n\n")}\n`}if(unlockItems.length>0){inventorySection+=`\n \n${unlockItems.join("\n")}\n`}}else{inventorySection="\n   \n  (...)\n"}return`<pkm_team_summary>\n\n : ${playerName} |  : [${unlocksStr}] |  : (${partyCount}/6)\n--------------------------------------------------\n${partyLines}\n--------------------------------------------------\n${inventorySection}\n--------------------------------------------------\n :  <PKM_BATTLE> \n</pkm_team_summary>`}async function handleGenerationBeforeInject(detail){const isDryRun=Boolean(detail&&detail.dryRun);try{try{uninjectPrompts([PKM_INJECT_ID])}catch(e){}const playerData=await getPlayerParty();console.log(`${PLUGIN_NAME} [DEBUG]  playerData:`,JSON.stringify(playerData,null,2));const evUpdateData={};if(playerData&&playerData.party){for(const[slotKey,slotData]of Object.entries(playerData.party)){if(slotData&&slotData.stats_meta&&slotData.stats_meta.ev_up>0){const currentEvLevel=slotData.stats_meta.ev_level||0;const evUp=slotData.stats_meta.ev_up;let newEvLevel;let mode;if(evUp>currentEvLevel&&currentEvLevel>=20){newEvLevel=evUp;mode="AI "}else{newEvLevel=currentEvLevel+evUp;mode=""}console.log(`${PLUGIN_NAME} [EV_UP] : ${slotKey},  ev_level: ${currentEvLevel}, ev_up: ${evUp},  ev_level: ${newEvLevel}, : ${mode}`);evUpdateData[`pkm.player.party.${slotKey}.stats_meta.ev_level`]=newEvLevel;evUpdateData[`pkm.player.party.${slotKey}.stats_meta.ev_up`]=0;slotData.stats_meta.ev_level=newEvLevel;slotData.stats_meta.ev_up=0}}}if(Object.keys(evUpdateData).length>0){try{await updateEraVars(evUpdateData);console.log(`${PLUGIN_NAME}   ev_up  ERA`)}catch(e){console.warn(`${PLUGIN_NAME}  ev_up :`,e)}}const proficiencyUpdateData={};if(playerData){const currentProficiency=playerData.trainerProficiency||0;const proficiencyUp=playerData.proficiency_up||0;if(proficiencyUp!==0){const newProficiency=Math.max(0,Math.min(255,currentProficiency+proficiencyUp));console.log(`${PLUGIN_NAME} [PROFICIENCY] : ${currentProficiency}, +${proficiencyUp} = ${newProficiency}`);proficiencyUpdateData["pkm.player.trainerProficiency"]=newProficiency;proficiencyUpdateData["pkm.player.proficiency_up"]=0;playerData.trainerProficiency=newProficiency;playerData.proficiency_up=0}}if(Object.keys(proficiencyUpdateData).length>0){try{await updateEraVars(proficiencyUpdateData);console.log(`${PLUGIN_NAME}   proficiency_up  ERA`)}catch(e){console.warn(`${PLUGIN_NAME}  proficiency_up :`,e)}}const avUpdateData={};if(playerData&&playerData.party){for(const[slotKey,slotData]of Object.entries(playerData.party)){if(!slotData)continue;if(!slotData.friendship){slotData.friendship={avs:{trust:0,passion:0,insight:0,devotion:0},av_up:{trust:0,passion:0,insight:0,devotion:0}}}if(!slotData.friendship.avs){slotData.friendship.avs={trust:0,passion:0,insight:0,devotion:0}}if(!slotData.friendship.av_up){slotData.friendship.av_up={trust:0,passion:0,insight:0,devotion:0}}if(!slotData.isAce){slotData.isAce=true;avUpdateData[`pkm.player.party.${slotKey}.isAce`]=true}const avUp=slotData.friendship.av_up;const currentAvs=slotData.friendship.avs;let hasUpdate=false;for(const stat of["trust","passion","insight","devotion"]){if(avUp[stat]&&typeof avUp[stat]==="number"&&avUp[stat]>0){const currentVal=currentAvs[stat]||0;const upVal=avUp[stat];let newVal;let mode;if(upVal>currentVal&&currentVal>=50){newVal=Math.min(255,upVal);mode="AI "}else{newVal=Math.min(255,currentVal+upVal);mode=""}console.log(`${PLUGIN_NAME} [AV_UP] : ${slotKey}, ${stat}: ${currentVal} -> ${newVal}, : ${mode}`);currentAvs[stat]=newVal;hasUpdate=true}}if(hasUpdate){avUpdateData[`pkm.player.party.${slotKey}.friendship.avs`]=currentAvs;avUpdateData[`pkm.player.party.${slotKey}.friendship.av_up`]={trust:0,passion:0,insight:0,devotion:0};slotData.friendship.avs=currentAvs;slotData.friendship.av_up={trust:0,passion:0,insight:0,devotion:0}}slotData.avs={...currentAvs}}}if(Object.keys(avUpdateData).length>0){try{await updateEraVars(avUpdateData);console.log(`${PLUGIN_NAME}   av_up  ERA`)}catch(e){console.warn(`${PLUGIN_NAME}  av_up :`,e)}}const parsedParty=parsePartyData(playerData?.party);if(!playerData||parsedParty.length===0){console.log(`${PLUGIN_NAME} `);return}console.log(`${PLUGIN_NAME} [DEBUG]  parsedParty:`,JSON.stringify(parsedParty,null,2));const slotsToUpdate={};const displayParty=parsedParty.map(p=>{const statsMeta=p.stats_meta||{};const hasValidIVs=isValidIVs(statsMeta.ivs);const hasEVLevel=statsMeta.ev_level!==undefined&&statsMeta.ev_level!==null;if(!hasValidIVs||!hasEVLevel){const filled=autoFillStatsMeta(p);const slotKey=`slot${p.slot||1}`;slotsToUpdate[slotKey]={stats_meta:filled};console.log(`${PLUGIN_NAME} [IVs]  ${p.name} (${slotKey})  stats_meta`);return{...p,stats_meta:filled}}return p});if(Object.keys(slotsToUpdate).length>0){try{const updateData={};for(const[slotKey,data]of Object.entries(slotsToUpdate)){updateData[`pkm.player.party.${slotKey}.stats_meta`]=data.stats_meta}await updateEraVars(updateData);console.log(`${PLUGIN_NAME}   ${Object.keys(slotsToUpdate).length}  stats_meta`)}catch(e){console.warn(`${PLUGIN_NAME}  stats_meta :`,e)}}const displayPlayerData={...playerData,party:displayParty};const promptContent=generatePlayerDataPrompt(displayPlayerData);if(!promptContent)return;injectPrompts([{id:PKM_INJECT_ID,position:"in_chat",depth:2,role:"system",should_scan:false,content:promptContent}]);console.log(`${PLUGIN_NAME}  `)}catch(e){console.error(`${PLUGIN_NAME} :`,e)}}async function handleWriteDone(detail){if(isProcessing){console.log(`${PLUGIN_NAME} `);return}const messageId=detail?.message_id??getLastMessageId();try{isProcessing=true;const messages=getChatMessages(messageId);if(!messages||messages.length===0){isProcessing=false;return}const msg=messages[0];const content=msg.message||"";if(!content.includes(`<${PKM_BATTLE_TAG}>`)){isProcessing=false;return}if(content.includes("<PKM_FRONTEND>")){console.log(`${PLUGIN_NAME} `);isProcessing=false;return}console.log(`${PLUGIN_NAME} ...`);const aiBattleData=parseAiBattleOutput(content);if(!aiBattleData){console.warn(`${PLUGIN_NAME} `);isProcessing=false;return}const completeBattle=await buildCompleteBattleJson(aiBattleData);await injectBattleFrontend(messageId,completeBattle);isProcessing=false}catch(e){console.error(`${PLUGIN_NAME} :`,e);isProcessing=false}}const NPC_INJECT_ID="pkm_npc_status";function getNpcStageDesc(npcId,stage){const addon=NPC_ADDON_DATA[npcId];if(!addon||!addon.relationship_stage){return{label:"",desc:"..."}}const stageKey=String(stage);const stageData=addon.relationship_stage;if(stage<0&&stageData.negative?.[stageKey]){return stageData.negative[stageKey]}else if(stage>0&&stageData.positive?.[stageKey]){return stageData.positive[stageKey]}else if(stageData.neutral?.[stageKey]){return stageData.neutral[stageKey]}return{label:"",desc:"..."}}function getNextLoveThreshold(npcId,currentStage){const addon=NPC_ADDON_DATA[npcId];if(!addon||!addon.love_thresholds)return null;const nextStage=currentStage+1;return addon.love_thresholds[nextStage]||null}function generateNpcStatusCard(npcId,npcState,playerBonds={}){const addon=NPC_ADDON_DATA[npcId];if(!addon)return null;const stage=npcState.stage||0;const love=npcState.love||0;const stageDesc=getNpcStageDesc(npcId,stage);const nextThreshold=getNextLoveThreshold(npcId,stage);const hasBond=addon.unlock_key&&playerBonds[addon.unlock_key]===true;let statusTag="";if(stage===4||stage===-2){statusTag="[Lock]"}else if(stage===3&&nextThreshold!==null&&love>=nextThreshold){if(hasBond){statusTag=`[AIStage 4]`}else{statusTag=`[]`}}else if(nextThreshold!==null&&love>=nextThreshold){const nextStage=stage+1;const nextStageDesc=getNpcStageDesc(npcId,nextStage);statusTag=`[UPStage ${nextStage}: ${nextStageDesc.label}]`}else if(stage===0&&love<=-20){statusTag="[DOWN]"}else if(stage===-1&&love<=-40){statusTag="[DOWN]"}let loveDisplay;if(nextThreshold!==null){loveDisplay=`${love}/${nextThreshold}`}else if(stage===0){loveDisplay=`${love} (: -20)`}else if(stage===-1){loveDisplay=`${love} (: -40)`}else{loveDisplay=`${love}/MAX`}let bondDisplay="";if(addon.unlock_item){bondDisplay=hasBond?`\n   - : ${addon.unlock_item.emoji} ${addon.unlock_item.name_cn} []`:`\n   - : ${addon.unlock_item.emoji} ${addon.unlock_item.name_cn} []`}return`${addon.name_cn} (${addon.name_en})\n   - [Stage ${stage}: ${stageDesc.label}] (Love: ${loveDisplay})\n   - : ${statusTag} ${stageDesc.desc}${bondDisplay}`}async function handleDynamicNpcInject(){console.log(`${PLUGIN_NAME} [NPC]  NPC ...`);try{const historyDepth=10;const allMessages=getChatMessages("0-{{lastMessageId}}");if(!allMessages||allMessages.length===0){console.log(`${PLUGIN_NAME} [NPC] `);return}const messages=allMessages.slice(-historyDepth);const contextText=messages.map(m=>{let text=m.message||"";text=text.replace(/<VariableInsert>[\s\S]*?<\/VariableInsert>/gi,"");text=text.replace(/<VariableEdit>[\s\S]*?<\/VariableEdit>/gi,"");text=text.replace(/<VariableDelete>[\s\S]*?<\/VariableDelete>/gi,"");return text}).join("\n").toLowerCase();const eraVars=await getEraVars();const npcsState=_.get(eraVars,"pkm.world_state.npcs",{});const passerbyState=_.get(eraVars,"pkm.world_state.passerby_npcs",{});const playerBonds=_.get(eraVars,"pkm.player.bonds",{});const currentLocation=_.get(eraVars,"pkm.world_state.location","Z");const mergedNpcsState={};for(const npcId in npcsState){mergedNpcsState[npcId]={...npcsState[npcId],...window._npcStateSnapshot&&window._npcStateSnapshot[npcId]}}const activeNpcs=[];for(const[npcId,keywords]of Object.entries(NPC_TRIGGERS)){const hit=keywords.some(k=>contextText.includes(k.toLowerCase()));if(hit&&mergedNpcsState[npcId]){activeNpcs.push(npcId)}}const activePasserby=[];for(const[name,state]of Object.entries(passerbyState)){if(name.startsWith("$"))continue;if(!state||typeof state!=="object")continue;let isActive=false;if(contextText.includes(name.toLowerCase())){isActive=true}if(!isActive&&state.tags){const tags=state.tags.split(",").map(t=>t.trim().toLowerCase()).filter(Boolean);if(tags.length>0){isActive=tags.some(tag=>contextText.includes(tag))}}if(isActive){activePasserby.push({name:name,state:state});console.log(`${PLUGIN_NAME} [NPC] : ${name} (tags: ${state.tags||""})`)}}console.log(`${PLUGIN_NAME} [NPC] : ${currentLocation} (${ZONE_DATA[currentLocation]?.name_cn||""})`);console.log(`${PLUGIN_NAME} [NPC] : ${activeNpcs.join(", ")||""}`);console.log(`${PLUGIN_NAME} [NPC] : ${activePasserby.map(p=>p.name).join(", ")||""}`);const sections=[];const zoneCard=generateZoneStatusCard(currentLocation);sections.push(zoneCard);if(activeNpcs.length>0){const mainCards=activeNpcs.map((npcId,index)=>{const state=mergedNpcsState[npcId]||{stage:0,love:0};const card=generateNpcStatusCard(npcId,state,playerBonds);return`${index+1}. ${card}`}).filter(Boolean).join("\n\n");sections.push(`/ NPC \n${mainCards}`)}if(activePasserby.length>0){const passerbyCards=activePasserby.map((p,index)=>{const{name:name,state:state}=p;const stage=state.stage||0;const love=state.love||0;let stageLabel="";if(stage===-2)stageLabel=" [Lock]";else if(stage===-1)stageLabel="";else if(stage===0)stageLabel="";else if(stage===1)stageLabel="";else if(stage===2)stageLabel="";else if(stage===3)stageLabel="";else if(stage===4)stageLabel=" [Lock]";return`${index+1}. ${name}\n   - [Stage ${stage}: ${stageLabel}] (Love: ${love})`}).join("\n\n");sections.push(` NPC \n${passerbyCards}`)}const promptContent=`<npc_status_brief>\n${sections.join("\n\n")}\n</npc_status_brief>`;injectPrompts([{id:NPC_INJECT_ID,position:"after_wi_scan",depth:0,role:"system",should_scan:false,content:promptContent}]);const totalActive=activeNpcs.length+activePasserby.length;console.log(`${PLUGIN_NAME} [NPC]   ${totalActive}  NPC  (: ${activeNpcs.length}, : ${activePasserby.length})`)}catch(e){console.error(`${PLUGIN_NAME} [NPC] :`,e)}}async function processNpcLoveUp(){const eraVars=await getEraVars();const npcsState=_.get(eraVars,"pkm.world_state.npcs",{});if(_.isEmpty(npcsState))return;if(!window._npcStateSnapshot){window._npcStateSnapshot={}}const updateData={};const rollbackWarnings=[];for(const[npcId,state]of Object.entries(npcsState)){if(!state||typeof state!=="object")continue;const currentStage=state.stage||0;const currentLove=state.love||0;const loveUp=state.love_up||0;const lastSnapshot=window._npcStateSnapshot[npcId]||{stage:currentStage,love:currentLove};let effectiveLove=currentLove;if(loveUp!==0){effectiveLove=Math.max(-100,Math.min(100,currentLove+loveUp));console.log(`${PLUGIN_NAME} [NPC] ${npcId}: love ${currentLove} + ${loveUp} = ${effectiveLove}`);updateData[`pkm.world_state.npcs.${npcId}.love`]=effectiveLove;updateData[`pkm.world_state.npcs.${npcId}.love_up`]=0}const addon=NPC_ADDON_DATA[npcId];const hasUnlockItem=addon&&addon.unlock_key&&addon.unlock_item;const canAutoUpgrade=addon&&(currentStage<3||currentStage===3&&!hasUnlockItem);if(canAutoUpgrade){const nextThreshold=getNextLoveThreshold(npcId,currentStage);if(nextThreshold!==null&&effectiveLove>=nextThreshold){const newStage=currentStage+1;console.log(`${PLUGIN_NAME} [NPC]  ${npcId}:  ${effectiveLove}/${nextThreshold} ${currentStage}  ${newStage}`);updateData[`pkm.world_state.npcs.${npcId}.stage`]=newStage;if(!window._npcStateSnapshot[npcId]){window._npcStateSnapshot[npcId]={}}window._npcStateSnapshot[npcId].stage=newStage}}if(addon&&currentStage===3&&hasUnlockItem){const nextThreshold=getNextLoveThreshold(npcId,3);if(nextThreshold!==null&&effectiveLove>=nextThreshold){const eraVars=await getEraVars();const playerBonds=_.get(eraVars,"pkm.player.bonds",{});const hasBond=playerBonds[addon.unlock_key]===true;if(!hasBond){console.log(`${PLUGIN_NAME} [UNLOCK]  ${npcId} : ${addon.unlock_key}`);if(!window._pendingUnlockEvents){window._pendingUnlockEvents=[]}window._pendingUnlockEvents.push({npcId:npcId,npcName:addon.name_cn,unlockKey:addon.unlock_key,unlockItem:addon.unlock_item,love:effectiveLove})}else{console.log(`${PLUGIN_NAME} [NPC] ${npcId}:  ${addon.unlock_key} AI  Stage 4`)}}}window._npcStateSnapshot[npcId]={stage:updateData[`pkm.world_state.npcs.${npcId}.stage`]!==undefined?updateData[`pkm.world_state.npcs.${npcId}.stage`]:currentStage,love:updateData[`pkm.world_state.npcs.${npcId}.love`]!==undefined?updateData[`pkm.world_state.npcs.${npcId}.love`]:currentLove}}if(Object.keys(updateData).length>0){try{await updateEraVars(updateData);console.log(`${PLUGIN_NAME} [NPC]   love_up  ERA`);if(rollbackWarnings.length>0){console.warn(`${PLUGIN_NAME} [NPC]   ${rollbackWarnings.length} :`);rollbackWarnings.forEach(w=>console.warn(`  - ${w}`))}}catch(e){console.warn(`${PLUGIN_NAME} [NPC]  love_up :`,e)}}await processUnlockEvents()}function generateUnlockEventPrompt(event){const{npcId:npcId,npcName:npcName,unlockKey:unlockKey,unlockItem:unlockItem}=event;return`<pkm_unlock_event>\n\n   ${npcName} \n\n\n${unlockItem.emoji} ${unlockItem.name_cn} (${unlockItem.name_en})\n\n :\n${unlockItem.desc}\n\n ${npcName}:\n"${unlockItem.dialogue}"\n\n :\n${unlockItem.effect}\n\n\n[]  ${npcName} \n <VariableEdit> \n1.   bonds."${unlockKey}": true\n2.   unlocks."${unlockKey}": true\n3.  NPC   "stage": 4 love \n\n<VariableEdit>\n{\n  "pkm": {\n    "world_state": {\n      "npcs": {\n        "${npcId}": {\n          "stage": 4\n        }\n      }\n    },\n    "player": {\n      "bonds": {\n        "${unlockKey}": true\n      },\n      "unlocks": {\n        "${unlockKey}": true\n      }\n    }\n  }\n}\n</VariableEdit>\n\n</pkm_unlock_event>`}async function processUnlockEvents(){if(!window._pendingUnlockEvents||window._pendingUnlockEvents.length===0){return}window._pendingUnlockEvents.sort((a,b)=>(b.love||0)-(a.love||0));const event=window._pendingUnlockEvents.shift();console.log(`${PLUGIN_NAME} [UNLOCK] : ${event.npcName} (love: ${event.love})`);if(window._pendingUnlockEvents.length>0){console.log(`${PLUGIN_NAME} [UNLOCK]  ${window._pendingUnlockEvents.length} `)}const prompt=generateUnlockEventPrompt(event);try{const injectionId="pkm_unlock_events";try{uninjectPrompts([injectionId])}catch(e){}injectPrompts([{id:injectionId,position:"in_chat",depth:0,role:"system",should_scan:false,content:prompt}]);console.log(`${PLUGIN_NAME} [UNLOCK]  : ${event.npcName}`);window._unlockEventInjected=true}catch(e){console.error(`${PLUGIN_NAME} [UNLOCK] :`,e)}}async function clearUnlockEventInjection(){if(window._unlockEventInjected){try{uninjectPrompts(["pkm_unlock_events"]);window._unlockEventInjected=false;console.log(`${PLUGIN_NAME} [UNLOCK]  `)}catch(e){}}}let retries=0;while(typeof eventEmit==="undefined"&&retries<30){await wait(100);retries++}if(typeof eventEmit==="undefined"){console.error(`${PLUGIN_NAME} API`);return}eventOn("CHAT_CHANGED",()=>resetState(""));eventOn("tavern_events.MESSAGE_SWIPED",()=>resetState(""));eventOn("tavern_events.MESSAGE_EDITED",()=>resetState(""));eventOn("GENERATION_AFTER_COMMANDS",async detail=>{await clearUnlockEventInjection();await handleGenerationBeforeInject(detail);await processNpcLoveUp();await handleDynamicNpcInject()});eventOn("era:writeDone",async detail=>{await handleWriteDone(detail)});window.PKMPlugin={getPlayerParty:getPlayerParty,setPlayerParty:setPlayerParty,async addToParty(pokemon){const playerData=await getPlayerParty()||{name:"",party:[],reserve:[]};const newParty=[...playerData.party,pokemon];return setPlayerParty("custom",newParty)},async addToReserve(pokemon){const eraVars=await getEraVars();const playerData=_.get(eraVars,"pkm.player",{name:"",party:[],reserve:[]});const newReserve=[...playerData.reserve||[],pokemon];updateEraVars({pkm:{player:{...playerData,reserve:newReserve}}});console.log(`${PLUGIN_NAME}  :`,pokemon);return newReserve},async setPlayerName(name){const eraVars=await getEraVars();const playerData=_.get(eraVars,"pkm.player",{name:"",party:[],reserve:[]});updateEraVars({pkm:{player:{...playerData,name:name}}});console.log(`${PLUGIN_NAME}  : ${name}`)},async triggerBattle(aiBattleData){const completeBattle=await buildCompleteBattleJson(aiBattleData);const frontendPayload=`<PKM_FRONTEND>\n${JSON.stringify(completeBattle)}\n</PKM_FRONTEND>`;await createChatMessages([{role:"assistant",message:frontendPayload}]);return completeBattle},version:"1.0.0"};async function preprocessEraUpdate(updateData){if(!updateData||typeof updateData!=="object")return updateData;const currentVars=await getEraVars();function processObject(obj,path=""){if(!obj||typeof obj!=="object")return obj;if(path==="pkm.player"||path.endsWith(".player")){const proficiencyUp=obj.proficiency_up;if(proficiencyUp!==undefined&&proficiencyUp!==null&&typeof proficiencyUp==="number"&&proficiencyUp!==0){const currentProficiency=_.get(currentVars,"pkm.player.trainerProficiency",0);const newProficiency=Math.max(0,Math.min(255,currentProficiency+proficiencyUp));console.log(`${PLUGIN_NAME} [PROFICIENCY] : ${currentProficiency}, +${proficiencyUp} = ${newProficiency}`);obj.trainerProficiency=newProficiency;obj.proficiency_up=0}}if(path.includes("pkm.player.party.slot")&&obj.stats_meta&&typeof obj.stats_meta==="object"){const slotMatch=path.match(/slot\d+/);if(slotMatch){const slotKey=slotMatch[0];const evUp=obj.stats_meta.ev_up;if(evUp!==undefined&&evUp!==null&&typeof evUp==="number"&&evUp>0){const currentEvLevel=_.get(currentVars,`pkm.player.party.${slotKey}.stats_meta.ev_level`,0);const newEvLevel=currentEvLevel+evUp;console.log(`${PLUGIN_NAME} [EV_UP] : ${slotKey},  ev_level: ${currentEvLevel}, ev_up: ${evUp},  ev_level: ${newEvLevel}`);obj.stats_meta.ev_level=newEvLevel;obj.stats_meta.ev_up=0}}}for(const[key,value]of Object.entries(obj)){if(value&&typeof value==="object"&&!Array.isArray(value)){const newPath=path?`${path}.${key}`:key;processObject(value,newPath)}}return obj}return processObject(updateData)}const originalEventEmit=window.eventEmit;if(originalEventEmit){window.eventEmit=function(eventName,data){if(eventName==="era:updateByObject"&&data){console.log(`${PLUGIN_NAME} []  ERA `);preprocessEraUpdate(data).then(processedData=>{originalEventEmit.call(window,eventName,processedData)})}else{originalEventEmit.apply(window,arguments)}};console.log(`${PLUGIN_NAME}  ERA ev_up/proficiency_up `)}console.log(`${PLUGIN_NAME}   `);console.log(`${PLUGIN_NAME} : window.PKMPlugin`);console.log(`${PLUGIN_NAME} - getPlayerParty(): `);console.log(`${PLUGIN_NAME} - setPlayerParty(mode, input):  (full/single/custom)`);console.log(`${PLUGIN_NAME} - addToParty(pokemon): `);console.log(`${PLUGIN_NAME} - addToReserve(pokemon): `);console.log(`${PLUGIN_NAME} - setPlayerName(name): `);console.log(`${PLUGIN_NAME} - triggerBattle(data): `)})();